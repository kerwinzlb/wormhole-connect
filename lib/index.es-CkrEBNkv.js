"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const H=require("./index-BMvV5qga.js"),F=require("./index-CWC2oqXK.js"),I=require("./browser-DokUOVlZ.js");var le={};Object.defineProperty(le,"__esModule",{value:!0});le.getLocalStorage=le.getLocalStorageOrThrow=le.getCrypto=le.getCryptoOrThrow=le.getLocation=le.getLocationOrThrow=le.getNavigator=le.getNavigatorOrThrow=le.getDocument=le.getDocumentOrThrow=le.getFromWindowOrThrow=le.getFromWindow=void 0;function lr(o){let t;return typeof window<"u"&&typeof window[o]<"u"&&(t=window[o]),t}le.getFromWindow=lr;function Fr(o){const t=lr(o);if(!t)throw new Error(`${o} is not defined in Window`);return t}le.getFromWindowOrThrow=Fr;function nw(){return Fr("document")}le.getDocumentOrThrow=nw;function ow(){return lr("document")}le.getDocument=ow;function aw(){return Fr("navigator")}le.getNavigatorOrThrow=aw;function cw(){return lr("navigator")}le.getNavigator=cw;function uw(){return Fr("location")}le.getLocationOrThrow=uw;function hw(){return lr("location")}le.getLocation=hw;function lw(){return Fr("crypto")}le.getCryptoOrThrow=lw;function pw(){return lr("crypto")}le.getCrypto=pw;function dw(){return Fr("localStorage")}le.getLocalStorageOrThrow=dw;function fw(){return lr("localStorage")}le.getLocalStorage=fw;var $o={};Object.defineProperty($o,"__esModule",{value:!0});$o.getWindowMetadata=void 0;const Pu=le;function gw(){let o,t;try{o=Pu.getDocumentOrThrow(),t=Pu.getLocationOrThrow()}catch{return null}function r(){const R=o.getElementsByTagName("link"),N=[];for(let M=0;M<R.length;M++){const C=R[M],V=C.getAttribute("rel");if(V&&V.toLowerCase().indexOf("icon")>-1){const q=C.getAttribute("href");if(q)if(q.toLowerCase().indexOf("https:")===-1&&q.toLowerCase().indexOf("http:")===-1&&q.indexOf("//")!==0){let Y=t.protocol+"//"+t.host;if(q.indexOf("/")===0)Y+=q;else{const me=t.pathname.split("/");me.pop();const te=me.join("/");Y+=te+"/"+q}N.push(Y)}else if(q.indexOf("//")===0){const Y=t.protocol+q;N.push(Y)}else N.push(q)}}return N}function s(...R){const N=o.getElementsByTagName("meta");for(let M=0;M<N.length;M++){const C=N[M],V=["itemprop","property","name"].map(q=>C.getAttribute(q)).filter(q=>q?R.includes(q):!1);if(V.length&&V){const q=C.getAttribute("content");if(q)return q}}return""}function a(){let R=s("name","og:site_name","og:title","twitter:title");return R||(R=o.title),R}function u(){return s("description","og:description","twitter:description","keywords")}const l=a(),f=u(),w=t.origin,_=r();return{description:f,url:w,icons:_,name:l}}$o.getWindowMetadata=gw;function yw(o,t=[]){const r=[];return Object.keys(o).forEach(s=>{if(t.length&&!t.includes(s))return;const a=o[s];r.push(...a.accounts)}),r}const mw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function vw(o,t){const{message:r,code:s}=mw[o];return{message:r,code:s}}function wo(o,t){return!!Array.isArray(o)}const ww=o=>JSON.stringify(o,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),bw=o=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function xo(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return bw(o)}catch{return o}}function Do(o){return typeof o=="string"?o:ww(o)||""}const _w="idb-keyval";var Ew=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>t+a;let s;return o.dbName&&o.storeName&&(s=I.createStore(o.dbName,o.storeName)),{name:_w,options:o,async hasItem(a){return!(typeof await I.get(r(a),s)>"u")},async getItem(a){return await I.get(r(a),s)??null},setItem(a,u){return I.set(r(a),u,s)},removeItem(a){return I.del(r(a),s)},getKeys(){return I.keys(s)},clear(){return I.clear(s)}}};const Iw="WALLET_CONNECT_V2_INDEXED_DB",Pw="keyvaluestorage";let Sw=class{constructor(){this.indexedDb=I.createStorage({driver:Ew({dbName:Iw,storeName:Pw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Do(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var so=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof H.dist.global<"u"?H.dist.global:typeof self<"u"?self:{},Es={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof so<"u"&&so.localStorage?Es.exports=so.localStorage:typeof window<"u"&&window.localStorage?Es.exports=window.localStorage:Es.exports=new t})();function Ow(o){var t;return[o[0],xo((t=o[1])!=null?t:"")]}let Rw=class{constructor(){this.localStorage=Es.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Ow)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return xo(r)}async setItem(t,r){this.localStorage.setItem(t,Do(r))}async removeItem(t){this.localStorage.removeItem(t)}};const Aw="wc_storage_version",Su=1,Nw=async(o,t,r)=>{const s=Aw,a=await t.getItem(s);if(a&&a>=Su){r(t);return}const u=await o.getKeys();if(!u.length){r(t);return}const l=[];for(;u.length;){const f=u.shift();if(!f)continue;const w=f.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const _=await o.getItem(f);await t.setItem(f,_),l.push(f)}}await t.setItem(s,Su),r(t),Tw(o,l)},Tw=async(o,t)=>{t.length&&t.forEach(async r=>{await o.removeItem(r)})};let Cw=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Rw;this.storage=t;try{const r=new Sw;Nw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var jr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var bo=function(o,t){return bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},bo(o,t)};function $w(o,t){bo(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var _o=function(){return _o=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},_o.apply(this,arguments)};function xw(o,t){var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(r[s[a]]=o[s[a]]);return r}function Dw(o,t,r,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,t,r,s);else for(var f=o.length-1;f>=0;f--)(l=o[f])&&(u=(a<3?l(u):a>3?l(t,r,u):l(t,r))||u);return a>3&&u&&Object.defineProperty(t,r,u),u}function Fw(o,t){return function(r,s){t(r,s,o)}}function jw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function qw(o,t,r,s){function a(u){return u instanceof r?u:new r(function(l){l(u)})}return new(r||(r=Promise))(function(u,l){function f(T){try{_(s.next(T))}catch(R){l(R)}}function w(T){try{_(s.throw(T))}catch(R){l(R)}}function _(T){T.done?u(T.value):a(T.value).then(f,w)}_((s=s.apply(o,t||[])).next())})}function Uw(o,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,l;return l={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function f(_){return function(T){return w([_,T])}}function w(_){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=_[0]&2?a.return:_[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,_[1])).done)return u;switch(a=0,u&&(_=[_[0]&2,u.value]),_[0]){case 0:case 1:u=_;break;case 4:return r.label++,{value:_[1],done:!1};case 5:r.label++,a=_[1],_=[0];continue;case 7:_=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(_[0]===6||_[0]===2)){r=0;continue}if(_[0]===3&&(!u||_[1]>u[0]&&_[1]<u[3])){r.label=_[1];break}if(_[0]===6&&r.label<u[1]){r.label=u[1],u=_;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(_);break}u[2]&&r.ops.pop(),r.trys.pop();continue}_=t.call(o,r)}catch(T){_=[6,T],a=0}finally{s=u=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}function Mw(o,t,r,s){s===void 0&&(s=r),o[s]=t[r]}function Lw(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function Eo(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],s=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function xh(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var s=r.call(o),a,u=[],l;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(f){l={error:f}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(l)throw l.error}}return u}function kw(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(xh(arguments[t]));return o}function zw(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var s=Array(o),a=0,t=0;t<r;t++)for(var u=arguments[t],l=0,f=u.length;l<f;l++,a++)s[a]=u[l];return s}function _i(o){return this instanceof _i?(this.v=o,this):new _i(o)}function Hw(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(o,t||[]),a,u=[];return a={},l("next"),l("throw"),l("return"),a[Symbol.asyncIterator]=function(){return this},a;function l(N){s[N]&&(a[N]=function(M){return new Promise(function(C,V){u.push([N,M,C,V])>1||f(N,M)})})}function f(N,M){try{w(s[N](M))}catch(C){R(u[0][3],C)}}function w(N){N.value instanceof _i?Promise.resolve(N.value.v).then(_,T):R(u[0][2],N)}function _(N){f("next",N)}function T(N){f("throw",N)}function R(N,M){N(M),u.shift(),u.length&&f(u[0][0],u[0][1])}}function Bw(o){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=o[a]?function(l){return(r=!r)?{value:_i(o[a](l)),done:a==="return"}:u?u(l):l}:u}}function Vw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof Eo=="function"?Eo(o):o[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=o[u]&&function(l){return new Promise(function(f,w){l=o[u](l),a(f,w,l.done,l.value)})}}function a(u,l,f,w){Promise.resolve(w).then(function(_){u({value:_,done:f})},l)}}function Kw(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function Ww(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function Jw(o){return o&&o.__esModule?o:{default:o}}function Gw(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function Qw(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const Yw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return _o},__asyncDelegator:Bw,__asyncGenerator:Hw,__asyncValues:Vw,__await:_i,__awaiter:qw,__classPrivateFieldGet:Gw,__classPrivateFieldSet:Qw,__createBinding:Mw,__decorate:Dw,__exportStar:Lw,__extends:$w,__generator:Uw,__importDefault:Jw,__importStar:Ww,__makeTemplateObject:Kw,__metadata:jw,__param:Fw,__read:xh,__rest:xw,__spread:kw,__spreadArrays:zw,__values:Eo},Symbol.toStringTag,{value:"Module"})),Ts=H.getAugmentedNamespace(Yw);var li={},no={},pi={};const Zw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:I.IEvents},Symbol.toStringTag,{value:"Module"})),Xw=H.getAugmentedNamespace(Zw);var Ou;function e0(){if(Ou)return pi;Ou=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.IHeartBeat=void 0;const o=Xw;class t extends o.IEvents{constructor(s){super()}}return pi.IHeartBeat=t,pi}var Ru;function Dh(){return Ru||(Ru=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Ts.__exportStar(e0(),o)}(no)),no}var oo={},cr={},Au;function t0(){if(Au)return cr;Au=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.HEARTBEAT_EVENTS=cr.HEARTBEAT_INTERVAL=void 0;const o=F.cjs;return cr.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,cr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},cr}var Nu;function Fh(){return Nu||(Nu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Ts.__exportStar(t0(),o)}(oo)),oo}var Tu;function r0(){if(Tu)return li;Tu=1,Object.defineProperty(li,"__esModule",{value:!0}),li.HeartBeat=void 0;const o=Ts,t=H.eventsExports,r=F.cjs,s=Dh(),a=Fh();class u extends s.IHeartBeat{constructor(f){super(f),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(f==null?void 0:f.interval)||a.HEARTBEAT_INTERVAL}static init(f){return o.__awaiter(this,void 0,void 0,function*(){const w=new u(f);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(f,w){this.events.on(f,w)}once(f,w){this.events.once(f,w)}off(f,w){this.events.off(f,w)}removeListener(f,w){this.events.removeListener(f,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return li.HeartBeat=u,li}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=Ts;t.__exportStar(r0(),o),t.__exportStar(Dh(),o),t.__exportStar(Fh(),o)})(jr);class i0 extends I.IEvents{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let s0=class extends I.IEvents{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}};class n0{constructor(t,r){this.logger=t,this.core=r}}let o0=class extends I.IEvents{constructor(t,r){super(),this.relayer=t,this.logger=r}},a0=class extends I.IEvents{constructor(t){super()}},c0=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}},u0=class extends I.IEvents{constructor(t,r){super(),this.relayer=t,this.logger=r}},h0=class extends I.IEvents{constructor(t,r){super(),this.core=t,this.logger=r}},l0=class{constructor(t,r){this.projectId=t,this.logger=r}},p0=class{constructor(t,r){this.projectId=t,this.logger=r}},d0=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},f0=class{constructor(t){this.client=t}};var Cu=function(o,t,r){if(r||arguments.length===2)for(var s=0,a=t.length,u;s<a;s++)(u||!(s in t))&&(u||(u=Array.prototype.slice.call(t,0,s)),u[s]=t[s]);return o.concat(u||Array.prototype.slice.call(t))},g0=function(){function o(t,r,s){this.name=t,this.version=r,this.os=s,this.type="browser"}return o}(),y0=function(){function o(t){this.version=t,this.type="node",this.name="node",this.os=H.dist.process.platform}return o}(),m0=function(){function o(t,r,s,a){this.name=t,this.version=r,this.os=s,this.bot=a,this.type="bot-device"}return o}(),v0=function(){function o(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return o}(),w0=function(){function o(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return o}(),b0=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,_0=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,$u=3,E0=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",b0]],xu=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function I0(o){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new w0:typeof navigator<"u"?S0(navigator.userAgent):R0()}function P0(o){return o!==""&&E0.reduce(function(t,r){var s=r[0],a=r[1];if(t)return t;var u=a.exec(o);return!!u&&[s,u]},!1)}function S0(o){var t=P0(o);if(!t)return null;var r=t[0],s=t[1];if(r==="searchbot")return new v0;var a=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);a?a.length<$u&&(a=Cu(Cu([],a,!0),A0($u-a.length),!0)):a=[];var u=a.join("."),l=O0(o),f=_0.exec(o);return f&&f[1]?new m0(r,u,l,f[1]):new g0(r,u,l)}function O0(o){for(var t=0,r=xu.length;t<r;t++){var s=xu[t],a=s[0],u=s[1],l=u.exec(o);if(l)return a}return null}function R0(){var o=typeof H.dist.process<"u"&&H.dist.process.version;return o?new y0(H.dist.process.version.slice(1)):null}function A0(o){for(var t=[],r=0;r<o;r++)t.push("0");return t}var pe={};Object.defineProperty(pe,"__esModule",{value:!0});pe.getLocalStorage=pe.getLocalStorageOrThrow=pe.getCrypto=pe.getCryptoOrThrow=jh=pe.getLocation=pe.getLocationOrThrow=jo=pe.getNavigator=pe.getNavigatorOrThrow=Fo=pe.getDocument=pe.getDocumentOrThrow=pe.getFromWindowOrThrow=pe.getFromWindow=void 0;function pr(o){let t;return typeof window<"u"&&typeof window[o]<"u"&&(t=window[o]),t}pe.getFromWindow=pr;function qr(o){const t=pr(o);if(!t)throw new Error(`${o} is not defined in Window`);return t}pe.getFromWindowOrThrow=qr;function N0(){return qr("document")}pe.getDocumentOrThrow=N0;function T0(){return pr("document")}var Fo=pe.getDocument=T0;function C0(){return qr("navigator")}pe.getNavigatorOrThrow=C0;function $0(){return pr("navigator")}var jo=pe.getNavigator=$0;function x0(){return qr("location")}pe.getLocationOrThrow=x0;function D0(){return pr("location")}var jh=pe.getLocation=D0;function F0(){return qr("crypto")}pe.getCryptoOrThrow=F0;function j0(){return pr("crypto")}pe.getCrypto=j0;function q0(){return qr("localStorage")}pe.getLocalStorageOrThrow=q0;function U0(){return pr("localStorage")}pe.getLocalStorage=U0;var qo={};Object.defineProperty(qo,"__esModule",{value:!0});var qh=qo.getWindowMetadata=void 0;const Du=pe;function M0(){let o,t;try{o=Du.getDocumentOrThrow(),t=Du.getLocationOrThrow()}catch{return null}function r(){const R=o.getElementsByTagName("link"),N=[];for(let M=0;M<R.length;M++){const C=R[M],V=C.getAttribute("rel");if(V&&V.toLowerCase().indexOf("icon")>-1){const q=C.getAttribute("href");if(q)if(q.toLowerCase().indexOf("https:")===-1&&q.toLowerCase().indexOf("http:")===-1&&q.indexOf("//")!==0){let Y=t.protocol+"//"+t.host;if(q.indexOf("/")===0)Y+=q;else{const me=t.pathname.split("/");me.pop();const te=me.join("/");Y+=te+"/"+q}N.push(Y)}else if(q.indexOf("//")===0){const Y=t.protocol+q;N.push(Y)}else N.push(q)}}return N}function s(...R){const N=o.getElementsByTagName("meta");for(let M=0;M<N.length;M++){const C=N[M],V=["itemprop","property","name"].map(q=>C.getAttribute(q)).filter(q=>q?R.includes(q):!1);if(V.length&&V){const q=C.getAttribute("content");if(q)return q}}return""}function a(){let R=s("name","og:site_name","og:title","twitter:title");return R||(R=o.title),R}function u(){return s("description","og:description","twitter:description","keywords")}const l=a(),f=u(),w=t.origin,_=r();return{description:f,url:w,icons:_,name:l}}qh=qo.getWindowMetadata=M0;const L0=":";function k0(o){const[t,r]=o.split(L0);return{namespace:t,reference:r}}function Uh(o,t){return o.includes(":")?[o]:t.chains||[]}const Mh="base10",ke="base16",Io="base64pad",Uo="utf8",Lh=0,dr=1,z0=0,Fu=1,Po=12,Mo=32;function H0(){const o=F.x25519.generateKeyPair();return{privateKey:I.toString(o.secretKey,ke),publicKey:I.toString(o.publicKey,ke)}}function So(){const o=F.random.randomBytes(Mo);return I.toString(o,ke)}function B0(o,t){const r=F.x25519.sharedKey(I.fromString(o,ke),I.fromString(t,ke),!0),s=new F.HKDF_1(F.sha256.SHA256,r).expand(Mo);return I.toString(s,ke)}function V0(o){const t=F.sha256.hash(I.fromString(o,ke));return I.toString(t,ke)}function xr(o){const t=F.sha256.hash(I.fromString(o,Uo));return I.toString(t,ke)}function K0(o){return I.fromString(`${o}`,Mh)}function Ii(o){return Number(I.toString(o,Mh))}function W0(o){const t=K0(typeof o.type<"u"?o.type:Lh);if(Ii(t)===dr&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof o.senderPublicKey<"u"?I.fromString(o.senderPublicKey,ke):void 0,s=typeof o.iv<"u"?I.fromString(o.iv,ke):F.random.randomBytes(Po),a=new F.chacha20poly1305.ChaCha20Poly1305(I.fromString(o.symKey,ke)).seal(s,I.fromString(o.message,Uo));return G0({type:t,sealed:a,iv:s,senderPublicKey:r})}function J0(o){const t=new F.chacha20poly1305.ChaCha20Poly1305(I.fromString(o.symKey,ke)),{sealed:r,iv:s}=Ss(o.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return I.toString(a,Uo)}function G0(o){if(Ii(o.type)===dr){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return I.toString(I.concat([o.type,o.senderPublicKey,o.iv,o.sealed]),Io)}return I.toString(I.concat([o.type,o.iv,o.sealed]),Io)}function Ss(o){const t=I.fromString(o,Io),r=t.slice(z0,Fu),s=Fu;if(Ii(r)===dr){const f=s+Mo,w=f+Po,_=t.slice(s,f),T=t.slice(f,w),R=t.slice(w);return{type:r,sealed:R,iv:T,senderPublicKey:_}}const a=s+Po,u=t.slice(s,a),l=t.slice(a);return{type:r,sealed:l,iv:u}}function Q0(o,t){const r=Ss(o);return kh({type:Ii(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?I.toString(r.senderPublicKey,ke):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function kh(o){const t=(o==null?void 0:o.type)||Lh;if(t===dr){if(typeof(o==null?void 0:o.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(o==null?void 0:o.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:o==null?void 0:o.senderPublicKey,receiverPublicKey:o==null?void 0:o.receiverPublicKey}}function ju(o){return o.type===dr&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var Y0=Object.defineProperty,qu=Object.getOwnPropertySymbols,Z0=Object.prototype.hasOwnProperty,X0=Object.prototype.propertyIsEnumerable,Uu=(o,t,r)=>t in o?Y0(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Mu=(o,t)=>{for(var r in t||(t={}))Z0.call(t,r)&&Uu(o,r,t[r]);if(qu)for(var r of qu(t))X0.call(t,r)&&Uu(o,r,t[r]);return o};const e1="ReactNative",tt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},t1="js";function Lo(){return typeof H.dist.process<"u"&&typeof H.dist.process.versions<"u"&&typeof H.dist.process.versions.node<"u"}function Ur(){return!Fo()&&!!jo()&&navigator.product===e1}function Mr(){return!Lo()&&!!jo()&&!!Fo()}function Pi(){return Ur()?tt.reactNative:Lo()?tt.node:Mr()?tt.browser:tt.unknown}function r1(){var o;try{return Ur()&&typeof H.dist.global<"u"&&typeof(H.dist.global==null?void 0:H.dist.global.Application)<"u"?(o=H.dist.global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function i1(o,t){let r=F.queryString.parse(o);return r=Mu(Mu({},r),t),o=F.queryString.stringify(r),o}function s1(){return qh()||{name:"",description:"",url:"",icons:[""]}}function n1(){if(Pi()===tt.reactNative&&typeof H.dist.global<"u"&&typeof(H.dist.global==null?void 0:H.dist.global.Platform)<"u"){const{OS:r,Version:s}=H.dist.global.Platform;return[r,s].join("-")}const o=I0();if(o===null)return"unknown";const t=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[t,o.name,o.version].join("-"):[t,o.version].join("-")}function o1(){var o;const t=Pi();return t===tt.browser?[t,((o=jh())==null?void 0:o.host)||"unknown"].join(":"):t}function a1(o,t,r){const s=n1(),a=o1();return[[o,t].join("-"),[t1,r].join("-"),s,a].join("/")}function c1({protocol:o,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:u,useOnCloseEvent:l,bundleId:f}){const w=r.split("?"),_=a1(o,t,s),T={auth:a,ua:_,projectId:u,useOnCloseEvent:l||void 0,origin:f||void 0},R=i1(w[1]||"",T);return w[0]+"?"+R}function ur(o,t){return o.filter(r=>t.includes(r)).length===o.length}function zh(o){return Object.fromEntries(o.entries())}function Hh(o){return new Map(Object.entries(o))}function Cr(o=F.cjs.FIVE_MINUTES,t){const r=F.cjs.toMiliseconds(o||F.cjs.FIVE_MINUTES);let s,a,u;return{resolve:l=>{u&&s&&(clearTimeout(u),s(l))},reject:l=>{u&&a&&(clearTimeout(u),a(l))},done:()=>new Promise((l,f)=>{u=setTimeout(()=>{f(new Error(t))},r),s=l,a=f})}}function Ei(o,t,r){return new Promise(async(s,a)=>{const u=setTimeout(()=>a(new Error(r)),t);try{const l=await o;s(l)}catch(l){a(l)}clearTimeout(u)})}function Bh(o,t){if(typeof t=="string"&&t.startsWith(`${o}:`))return t;if(o.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(o.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${o}`)}function u1(o){return Bh("topic",o)}function h1(o){return Bh("id",o)}function Vh(o){const[t,r]=o.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function wt(o,t){return F.cjs.fromMiliseconds(Date.now()+F.cjs.toMiliseconds(o))}function Gt(o){return Date.now()>=F.cjs.toMiliseconds(o)}function Se(o,t){return`${o}${t?`:${t}`:""}`}function ao(o=[],t=[]){return[...new Set([...o,...t])]}async function l1({id:o,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${o}&sessionTopic=${t}`,l=Pi();l===tt.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):l===tt.reactNative&&typeof(H.dist.global==null?void 0:H.dist.global.Linking)<"u"&&await H.dist.global.Linking.openURL(u)}catch(s){console.error(s)}}async function p1(o,t){try{return await o.getItem(t)||(Mr()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const d1="irn";function Oo(o){return(o==null?void 0:o.relay)||{protocol:d1}}function Is(o){const t=I.C[o];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${o}`);return t}var f1=Object.defineProperty,Lu=Object.getOwnPropertySymbols,g1=Object.prototype.hasOwnProperty,y1=Object.prototype.propertyIsEnumerable,ku=(o,t,r)=>t in o?f1(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,m1=(o,t)=>{for(var r in t||(t={}))g1.call(t,r)&&ku(o,r,t[r]);if(Lu)for(var r of Lu(t))y1.call(t,r)&&ku(o,r,t[r]);return o};function v1(o,t="-"){const r={},s="relay"+t;return Object.keys(o).forEach(a=>{if(a.startsWith(s)){const u=a.replace(s,""),l=o[a];r[u]=l}}),r}function zu(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const t=o.indexOf(":"),r=o.indexOf("?")!==-1?o.indexOf("?"):void 0,s=o.substring(0,t),a=o.substring(t+1,r).split("@"),u=typeof r<"u"?o.substring(r):"",l=F.queryString.parse(u);return{protocol:s,topic:w1(a[0]),version:parseInt(a[1],10),symKey:l.symKey,relay:v1(l)}}function w1(o){return o.startsWith("//")?o.substring(2):o}function b1(o,t="-"){const r="relay",s={};return Object.keys(o).forEach(a=>{const u=r+t+a;o[a]&&(s[u]=o[a])}),s}function _1(o){return`${o.protocol}:${o.topic}@${o.version}?`+F.queryString.stringify(m1({symKey:o.symKey},b1(o.relay)))}function Lr(o){const t=[];return o.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function E1(o){const t=[];return Object.values(o).forEach(r=>{t.push(...Lr(r.accounts))}),t}function I1(o,t){const r=[];return Object.values(o).forEach(s=>{Lr(s.accounts).includes(t)&&r.push(...s.methods)}),r}function P1(o,t){const r=[];return Object.values(o).forEach(s=>{Lr(s.accounts).includes(t)&&r.push(...s.events)}),r}function S1(o,t){const r=Ps(o,t);if(r)throw new Error(r.message);const s={};for(const[a,u]of Object.entries(o))s[a]={methods:u.methods,events:u.events,chains:u.accounts.map(l=>`${l.split(":")[0]}:${l.split(":")[1]}`)};return s}function ko(o){return o.includes(":")}function vi(o){return ko(o)?o.split(":")[0]:o}const O1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},R1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function x(o,t){const{message:r,code:s}=R1[o];return{message:t?`${r} ${t}`:r,code:s}}function Pe(o,t){const{message:r,code:s}=O1[o];return{message:t?`${r} ${t}`:r,code:s}}function hr(o,t){return!!Array.isArray(o)}function Dr(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function Je(o){return typeof o>"u"}function Ne(o,t){return t&&Je(o)?!0:typeof o=="string"&&!!o.trim().length}function zo(o,t){return typeof o=="number"&&!isNaN(o)}function A1(o,t){const{requiredNamespaces:r}=t,s=Object.keys(o.namespaces),a=Object.keys(r);let u=!0;return ur(a,s)?(s.forEach(l=>{const{accounts:f,methods:w,events:_}=o.namespaces[l],T=Lr(f),R=r[l];(!ur(Uh(l,R),T)||!ur(R.methods,w)||!ur(R.events,_))&&(u=!1)}),u):!1}function Os(o){return Ne(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function N1(o){if(Ne(o,!1)&&o.includes(":")){const t=o.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Os(r)}}return!1}function T1(o){if(Ne(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function C1(o){var t;return(t=o==null?void 0:o.proposer)==null?void 0:t.publicKey}function $1(o){return o==null?void 0:o.topic}function x1(o,t){let r=null;return Ne(o==null?void 0:o.publicKey,!1)||(r=x("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function Hu(o){let t=!0;return hr(o)?o.length&&(t=o.every(r=>Ne(r,!1))):t=!1,t}function D1(o,t,r){let s=null;return hr(t)&&t.length?t.forEach(a=>{s||Os(a)||(s=Pe("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Os(o)||(s=Pe("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function F1(o,t,r){let s=null;return Object.entries(o).forEach(([a,u])=>{if(s)return;const l=D1(a,Uh(a,u),`${t} ${r}`);l&&(s=l)}),s}function j1(o,t){let r=null;return hr(o)?o.forEach(s=>{r||N1(s)||(r=Pe("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=Pe("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function q1(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=j1(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function U1(o,t){let r=null;return Hu(o==null?void 0:o.methods)?Hu(o==null?void 0:o.events)||(r=Pe("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=Pe("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Kh(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=U1(s,`${t}, namespace`);a&&(r=a)}),r}function M1(o,t,r){let s=null;if(o&&Dr(o)){const a=Kh(o,t);a&&(s=a);const u=F1(o,t,r);u&&(s=u)}else s=x("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function Ps(o,t){let r=null;if(o&&Dr(o)){const s=Kh(o,t);s&&(r=s);const a=q1(o,t);a&&(r=a)}else r=x("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Wh(o){return Ne(o.protocol,!0)}function L1(o,t){let r=!1;return o?o&&hr(o)&&o.length&&o.forEach(s=>{r=Wh(s)}):r=!0,r}function k1(o){return typeof o=="number"}function We(o){return typeof o<"u"&&typeof o!==null}function z1(o){return!(!o||typeof o!="object"||!o.code||!zo(o.code)||!o.message||!Ne(o.message,!1))}function H1(o){return!(Je(o)||!Ne(o.method,!1))}function B1(o){return!(Je(o)||Je(o.result)&&Je(o.error)||!zo(o.id)||!Ne(o.jsonrpc,!1))}function V1(o){return!(Je(o)||!Ne(o.name,!1))}function Bu(o,t){return!(!Os(t)||!E1(o).includes(t))}function K1(o,t,r){return Ne(r,!1)?I1(o,t).includes(r):!1}function W1(o,t,r){return Ne(r,!1)?P1(o,t).includes(r):!1}function Vu(o,t,r){let s=null;const a=J1(o),u=G1(t),l=Object.keys(a),f=Object.keys(u),w=Ku(Object.keys(o)),_=Ku(Object.keys(t)),T=w.filter(R=>!_.includes(R));return T.length&&(s=x("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${T.toString()}
      Received: ${Object.keys(t).toString()}`)),ur(l,f)||(s=x("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${l.toString()}
      Approved: ${f.toString()}`)),Object.keys(t).forEach(R=>{if(!R.includes(":")||s)return;const N=Lr(t[R].accounts);N.includes(R)||(s=x("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${R}
        Required: ${R}
        Approved: ${N.toString()}`))}),l.forEach(R=>{s||(ur(a[R].methods,u[R].methods)?ur(a[R].events,u[R].events)||(s=x("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${R}`)):s=x("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${R}`))}),s}function J1(o){const t={};return Object.keys(o).forEach(r=>{var s;r.includes(":")?t[r]=o[r]:(s=o[r].chains)==null||s.forEach(a=>{t[a]={methods:o[r].methods,events:o[r].events}})}),t}function Ku(o){return[...new Set(o.map(t=>t.includes(":")?t.split(":")[0]:t))]}function G1(o){const t={};return Object.keys(o).forEach(r=>{if(r.includes(":"))t[r]=o[r];else{const s=Lr(o[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:o[r].accounts.filter(u=>u.includes(`${a}:`)),methods:o[r].methods,events:o[r].events}})}}),t}function Q1(o,t){return zo(o)&&o<=t.max&&o>=t.min}function Wu(){const o=Pi();return new Promise(t=>{switch(o){case tt.browser:t(Y1());break;case tt.reactNative:t(Z1());break;case tt.node:t(X1());break;default:t(!0)}})}function Y1(){return Mr()&&(navigator==null?void 0:navigator.onLine)}async function Z1(){if(Ur()&&typeof H.dist.global<"u"&&H.dist.global!=null&&H.dist.global.NetInfo){const o=await(H.dist.global==null?void 0:H.dist.global.NetInfo.fetch());return o==null?void 0:o.isConnected}return!0}function X1(){return!0}function eb(o){switch(Pi()){case tt.browser:tb(o);break;case tt.reactNative:rb(o);break}}function tb(o){!Ur()&&Mr()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function rb(o){var t;Ur()&&typeof H.dist.global<"u"&&H.dist.global!=null&&H.dist.global.NetInfo&&((t=H.dist.global)==null||t.NetInfo.addEventListener(r=>o(r==null?void 0:r.isConnected)))}const co={};let vs=class{static get(t){return co[t]}static set(t,r){co[t]=r}static delete(t){delete co[t]}};class Ut extends I.r{constructor(t){super(t),this.events=new H.eventsExports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(I.formatJsonRpcRequest(t.method,t.params||[],t.id||I.getBigIntRpcId().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{I.isJsonRpcError(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),I.isJsonRpcResponse(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}function ib(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),l=u.charCodeAt(0);if(r[l]!==255)throw new TypeError(u+" is ambiguous");r[l]=a}var f=o.length,w=o.charAt(0),_=Math.log(f)/Math.log(256),T=Math.log(256)/Math.log(f);function R(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var V=0,q=0,Y=0,me=C.length;Y!==me&&C[Y]===0;)Y++,V++;for(var te=(me-Y)*T+1>>>0,re=new Uint8Array(te);Y!==me;){for(var ae=C[Y],Te=0,ve=te-1;(ae!==0||Te<q)&&ve!==-1;ve--,Te++)ae+=256*re[ve]>>>0,re[ve]=ae%f>>>0,ae=ae/f>>>0;if(ae!==0)throw new Error("Non-zero carry");q=Te,Y++}for(var we=te-q;we!==te&&re[we]===0;)we++;for(var bt=w.repeat(V);we<te;++we)bt+=o.charAt(re[we]);return bt}function N(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var V=0;if(C[V]!==" "){for(var q=0,Y=0;C[V]===w;)q++,V++;for(var me=(C.length-V)*_+1>>>0,te=new Uint8Array(me);C[V];){var re=r[C.charCodeAt(V)];if(re===255)return;for(var ae=0,Te=me-1;(re!==0||ae<Y)&&Te!==-1;Te--,ae++)re+=f*te[Te]>>>0,te[Te]=re%256>>>0,re=re/256>>>0;if(re!==0)throw new Error("Non-zero carry");Y=ae,V++}if(C[V]!==" "){for(var ve=me-Y;ve!==me&&te[ve]===0;)ve++;for(var we=new Uint8Array(q+(me-ve)),bt=q;ve!==me;)we[bt++]=te[ve++];return we}}}function M(C){var V=N(C);if(V)return V;throw new Error(`Non-${t} character`)}return{encode:R,decodeUnsafe:N,decode:M}}var sb=ib,nb=sb;const Jh=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},ob=o=>new TextEncoder().encode(o),ab=o=>new TextDecoder().decode(o);class cb{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class ub{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Gh(this,t)}}class hb{constructor(t){this.decoders=t}or(t){return Gh(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Gh=(o,t)=>new hb({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class lb{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new cb(t,r,s),this.decoder=new ub(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Cs=({name:o,prefix:t,encode:r,decode:s})=>new lb(o,t,r,s),Si=({prefix:o,name:t,alphabet:r})=>{const{encode:s,decode:a}=nb(r,t);return Cs({prefix:o,name:t,encode:s,decode:u=>Jh(a(u))})},pb=(o,t,r,s)=>{const a={};for(let T=0;T<t.length;++T)a[t[T]]=T;let u=o.length;for(;o[u-1]==="=";)--u;const l=new Uint8Array(u*r/8|0);let f=0,w=0,_=0;for(let T=0;T<u;++T){const R=a[o[T]];if(R===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<r|R,f+=r,f>=8&&(f-=8,l[_++]=255&w>>f)}if(f>=r||255&w<<8-f)throw new SyntaxError("Unexpected end of data");return l},db=(o,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",l=0,f=0;for(let w=0;w<o.length;++w)for(f=f<<8|o[w],l+=8;l>r;)l-=r,u+=t[a&f>>l];if(l&&(u+=t[a&f<<r-l]),s)for(;u.length*r&7;)u+="=";return u},xe=({name:o,prefix:t,bitsPerChar:r,alphabet:s})=>Cs({prefix:t,name:o,encode(a){return db(a,s,r)},decode(a){return pb(a,s,r,o)}}),fb=Cs({prefix:"\0",name:"identity",encode:o=>ab(o),decode:o=>ob(o)});var gb=Object.freeze({__proto__:null,identity:fb});const yb=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var mb=Object.freeze({__proto__:null,base2:yb});const vb=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var wb=Object.freeze({__proto__:null,base8:vb});const bb=Si({prefix:"9",name:"base10",alphabet:"0123456789"});var _b=Object.freeze({__proto__:null,base10:bb});const Eb=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ib=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Pb=Object.freeze({__proto__:null,base16:Eb,base16upper:Ib});const Sb=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ob=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Rb=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ab=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Nb=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Tb=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Cb=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$b=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),xb=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Db=Object.freeze({__proto__:null,base32:Sb,base32upper:Ob,base32pad:Rb,base32padupper:Ab,base32hex:Nb,base32hexupper:Tb,base32hexpad:Cb,base32hexpadupper:$b,base32z:xb});const Fb=Si({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),jb=Si({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var qb=Object.freeze({__proto__:null,base36:Fb,base36upper:jb});const Ub=Si({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Mb=Si({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Lb=Object.freeze({__proto__:null,base58btc:Ub,base58flickr:Mb});const kb=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),zb=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Hb=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Bb=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Vb=Object.freeze({__proto__:null,base64:kb,base64pad:zb,base64url:Hb,base64urlpad:Bb});const Qh=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Kb=Qh.reduce((o,t,r)=>(o[r]=t,o),[]),Wb=Qh.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function Jb(o){return o.reduce((t,r)=>(t+=Kb[r],t),"")}function Gb(o){const t=[];for(const r of o){const s=Wb[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const Qb=Cs({prefix:"🚀",name:"base256emoji",encode:Jb,decode:Gb});var Yb=Object.freeze({__proto__:null,base256emoji:Qb}),Zb=Yh,Ju=128,Xb=127,e_=~Xb,t_=Math.pow(2,31);function Yh(o,t,r){t=t||[],r=r||0;for(var s=r;o>=t_;)t[r++]=o&255|Ju,o/=128;for(;o&e_;)t[r++]=o&255|Ju,o>>>=7;return t[r]=o|0,Yh.bytes=r-s+1,t}var r_=Ro,i_=128,Gu=127;function Ro(o,s){var r=0,s=s||0,a=0,u=s,l,f=o.length;do{if(u>=f)throw Ro.bytes=0,new RangeError("Could not decode varint");l=o[u++],r+=a<28?(l&Gu)<<a:(l&Gu)*Math.pow(2,a),a+=7}while(l>=i_);return Ro.bytes=u-s,r}var s_=Math.pow(2,7),n_=Math.pow(2,14),o_=Math.pow(2,21),a_=Math.pow(2,28),c_=Math.pow(2,35),u_=Math.pow(2,42),h_=Math.pow(2,49),l_=Math.pow(2,56),p_=Math.pow(2,63),d_=function(o){return o<s_?1:o<n_?2:o<o_?3:o<a_?4:o<c_?5:o<u_?6:o<h_?7:o<l_?8:o<p_?9:10},f_={encode:Zb,decode:r_,encodingLength:d_},Zh=f_;const Qu=(o,t,r=0)=>(Zh.encode(o,t,r),t),Yu=o=>Zh.encodingLength(o),Ao=(o,t)=>{const r=t.byteLength,s=Yu(o),a=s+Yu(r),u=new Uint8Array(a+r);return Qu(o,u,0),Qu(r,u,s),u.set(t,a),new g_(o,r,t,u)};class g_{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const Xh=({name:o,code:t,encode:r})=>new y_(o,t,r);class y_{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Ao(this.code,r):r.then(s=>Ao(this.code,s))}else throw Error("Unknown type, must be binary type")}}const el=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),m_=Xh({name:"sha2-256",code:18,encode:el("SHA-256")}),v_=Xh({name:"sha2-512",code:19,encode:el("SHA-512")});var w_=Object.freeze({__proto__:null,sha256:m_,sha512:v_});const tl=0,b_="identity",rl=Jh,__=o=>Ao(tl,rl(o)),E_={code:tl,name:b_,encode:rl,digest:__};var I_=Object.freeze({__proto__:null,identity:E_});new TextEncoder,new TextDecoder;const Zu={...gb,...mb,...wb,..._b,...Pb,...Db,...qb,...Lb,...Vb,...Yb};({...w_,...I_});function il(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function P_(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?il(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function sl(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const Xu=sl("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),uo=sl("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=P_(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),S_={utf8:Xu,"utf-8":Xu,hex:Zu.base16,latin1:uo,ascii:uo,binary:uo,...Zu};function O_(o,t="utf8"){const r=S_[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?il(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const nl="wc",R_=2,Ho="core",Qt=`${nl}@2:${Ho}:`,A_={name:Ho,logger:"error"},N_={database:":memory:"},T_="crypto",eh="client_ed25519_seed",C_=F.cjs.ONE_DAY,$_="keychain",x_="0.3",D_="messages",F_="0.3",j_=F.cjs.SIX_HOURS,q_="publisher",ol="irn",U_="error",al="wss://relay.walletconnect.com",th="wss://relay.walletconnect.org",M_="relayer",qe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},L_="_subscription",jt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},k_=F.cjs.ONE_SECOND,z_="2.11.0",H_=1e4,B_="0.3",V_="WALLETCONNECT_CLIENT_ID",vt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},K_="subscription",W_="0.3",J_=F.cjs.FIVE_SECONDS*1e3,G_="pairing",Q_="0.3",di={wc_pairingDelete:{req:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:F.cjs.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:F.cjs.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:0},res:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:0}}},wi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Pt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Y_="history",Z_="0.3",X_="expirer",lt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},eE="0.3",ho="verify-api",$r="https://verify.walletconnect.com",No="https://verify.walletconnect.org",tE=[$r,No],rE="echo",iE="https://echo.walletconnect.com";class sE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=$_,this.version=x_,this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=x("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=I.E(r,this.name)}get context(){return I.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,zh(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Hh(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}}class nE{constructor(t,r,s){this.core=t,this.logger=r,this.name=T_,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=I.generateKeyPair(a);return I.encodeIss(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=H0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),l=I.generateKeyPair(u),f=So(),w=C_;return await I.signJWT(f,a,w,l)},this.generateSharedKey=(a,u,l)=>{this.isInitialized();const f=this.getPrivateKey(a),w=B0(f,u);return this.setSymKey(w,l)},this.setSymKey=async(a,u)=>{this.isInitialized();const l=u||V0(a);return await this.keychain.set(l,a),l},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,l)=>{this.isInitialized();const f=kh(l),w=Do(u);if(ju(f)){const N=f.senderPublicKey,M=f.receiverPublicKey;a=await this.generateSharedKey(N,M)}const _=this.getSymKey(a),{type:T,senderPublicKey:R}=f;return W0({type:T,symKey:_,message:w,senderPublicKey:R})},this.decode=async(a,u,l)=>{this.isInitialized();const f=Q0(u,l);if(ju(f)){const w=f.receiverPublicKey,_=f.senderPublicKey;a=await this.generateSharedKey(w,_)}try{const w=this.getSymKey(a),_=J0({symKey:w,encoded:u});return xo(_)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const u=Ss(a);return Ii(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Ss(a);return u.senderPublicKey?I.toString(u.senderPublicKey,ke):void 0},this.core=t,this.logger=I.E(r,this.name),this.keychain=s||new sE(this.core,this.logger)}get context(){return I.y(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(eh)}catch{t=So(),await this.keychain.set(eh,t)}return O_(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}}class oE extends n0{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=D_,this.version=F_,this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=xr(a);let l=this.messages.get(s);return typeof l>"u"&&(l={}),typeof l[u]<"u"||(l[u]=a,this.messages.set(s,l),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),l=xr(a);return typeof u[l]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=I.E(t,this.name),this.core=r}get context(){return I.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,zh(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Hh(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}}class aE extends o0{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new H.eventsExports.EventEmitter,this.name=q_,this.queue=new Map,this.publishTimeout=F.cjs.toMiliseconds(F.cjs.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const f=(u==null?void 0:u.ttl)||j_,w=Oo(u),_=(u==null?void 0:u.prompt)||!1,T=(u==null?void 0:u.tag)||0,R=(u==null?void 0:u.id)||I.getBigIntRpcId().toString(),N={topic:s,message:a,opts:{ttl:f,relay:w,prompt:_,tag:T,id:R}},M=setTimeout(()=>this.queue.set(R,N),this.publishTimeout);try{await await Ei(this.rpcPublish(s,a,f,w,_,T,R),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(R),this.relayer.events.emit(qe.publish,N)}catch(C){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=u==null?void 0:u.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(R),C;return}finally{clearTimeout(M)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(f){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(f),f}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=I.E(r,this.name),this.registerEventListeners()}get context(){return I.y(this.logger)}rpcPublish(t,r,s,a,u,l,f){var w,_,T,R;const N={method:Is(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:l},id:f};return Je((w=N.params)==null?void 0:w.prompt)&&((_=N.params)==null||delete _.prompt),Je((T=N.params)==null?void 0:T.tag)&&((R=N.params)==null||delete R.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(jr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(qe.connection_stalled);return}this.checkQueue()}),this.relayer.on(qe.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class cE{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var uE=Object.defineProperty,hE=Object.defineProperties,lE=Object.getOwnPropertyDescriptors,rh=Object.getOwnPropertySymbols,pE=Object.prototype.hasOwnProperty,dE=Object.prototype.propertyIsEnumerable,ih=(o,t,r)=>t in o?uE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,fi=(o,t)=>{for(var r in t||(t={}))pE.call(t,r)&&ih(o,r,t[r]);if(rh)for(var r of rh(t))dE.call(t,r)&&ih(o,r,t[r]);return o},lo=(o,t)=>hE(o,lE(t));class fE extends u0{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new cE,this.events=new H.eventsExports.EventEmitter,this.name=K_,this.version=W_,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Qt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=Oo(a),l={topic:s,relay:u};this.pending.set(s,l);const f=await this.rpcSubscribe(s,u);return this.onSubscribe(f,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),f}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const l=new F.cjs.Watch;l.start(this.pendingSubscriptionWatchLabel);const f=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(f),l.stop(this.pendingSubscriptionWatchLabel),a(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=J_&&(clearInterval(f),l.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=I.E(r,this.name),this.clientId=""}get context(){return I.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=Oo(s);await this.rpcUnsubscribe(t,r,a);const u=Pe("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:Is(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Ei(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(qe.connection_stalled)}return xr(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:Is(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Ei(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(qe.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:Is(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,lo(fi({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,fi({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,fi({},r)),this.topicMap.set(r.topic,t),this.events.emit(vt.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=x("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(vt.deleted,lo(fi({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(vt.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(vt.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);hr(r)&&this.onBatchSubscribe(r.map((s,a)=>lo(fi({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(jr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(qe.connect,async()=>{await this.onConnect()}),this.relayer.on(qe.disconnect,()=>{this.onDisconnect()}),this.events.on(vt.created,async t=>{const r=vt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(vt.deleted,async t=>{const r=vt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var gE=Object.defineProperty,sh=Object.getOwnPropertySymbols,yE=Object.prototype.hasOwnProperty,mE=Object.prototype.propertyIsEnumerable,nh=(o,t,r)=>t in o?gE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,vE=(o,t)=>{for(var r in t||(t={}))yE.call(t,r)&&nh(o,r,t[r]);if(sh)for(var r of sh(t))mE.call(t,r)&&nh(o,r,t[r]);return o};class wE extends a0{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new H.eventsExports.EventEmitter,this.name=M_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(qe.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(qe.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(jt.payload,this.onPayloadHandler),this.provider.on(jt.connect,this.onConnectHandler),this.provider.on(jt.disconnect,this.onDisconnectHandler),this.provider.on(jt.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?I.E(t.logger,this.name):I.ot(I.k({level:t.logger||U_})),this.messages=new oE(this.logger,t.core),this.subscriber=new fE(this,this.logger),this.publisher=new aE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||al,this.projectId=t.projectId,this.bundleId=r1(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${th}...`),await this.restartTransport(th)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},H_)}get context(){return I.y(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const l=f=>{f.topic===t&&(this.subscriber.off(vt.created,l),u())};return await Promise.all([new Promise(f=>{u=f,this.subscriber.on(vt.created,l)}),new Promise(async f=>{a=await this.subscriber.subscribe(t,r),f()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ei(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(vt.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await Ei(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(jt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Wu())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ut(new I.f(c1({sdkVersion:z_,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),I.isJsonRpcRequest(t)){if(!t.method.endsWith(L_))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,l={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(vE({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(t),await this.onMessageEvent(l)}else I.isJsonRpcResponse(t)&&this.events.emit(qe.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(qe.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=I.formatJsonRpcResult(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(jt.payload,this.onPayloadHandler),this.provider.off(jt.connect,this.onConnectHandler),this.provider.off(jt.disconnect,this.onDisconnectHandler),this.provider.off(jt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(qe.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Wu();eb(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(qe.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},F.cjs.toMiliseconds(k_)))}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var bE=Object.defineProperty,oh=Object.getOwnPropertySymbols,_E=Object.prototype.hasOwnProperty,EE=Object.prototype.propertyIsEnumerable,ah=(o,t,r)=>t in o?bE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,ch=(o,t)=>{for(var r in t||(t={}))_E.call(t,r)&&ah(o,r,t[r]);if(oh)for(var r of oh(t))EE.call(t,r)&&ah(o,r,t[r]);return o};class $s extends c0{constructor(t,r,s,a=Qt,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=B_,this.cached=[],this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!Je(l)?this.map.set(this.getKey(l),l):C1(l)?this.map.set(l.id,l):$1(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,f)=>{this.isInitialized(),this.map.has(l)?await this.update(l,f):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:f}),this.map.set(l,f),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(f=>Object.keys(l).every(w=>I.Gi(f[w],l[w]))):this.values),this.update=async(l,f)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:f});const w=ch(ch({},this.getData(l)),f);this.map.set(l,w),await this.persist()},this.delete=async(l,f)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:f}),this.map.delete(l),await this.persist())},this.logger=I.E(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return I.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=x("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}}class IE{constructor(t,r){this.core=t,this.logger=r,this.name=G_,this.version=Q_,this.events=new H.Ct,this.initialized=!1,this.storagePrefix=Qt,this.ignoredPayloadTypes=[dr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=So(),a=await this.core.crypto.setSymKey(s),u=wt(F.cjs.FIVE_MINUTES),l={protocol:ol},f={topic:a,expiry:u,relay:l,active:!1},w=_1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:l});return await this.pairings.set(a,f),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:l}=zu(s.uri);let f;if(this.pairings.keys.includes(a)&&(f=this.pairings.get(a),f.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=wt(F.cjs.FIVE_MINUTES),_={topic:a,relay:l,expiry:w,active:!1};return await this.pairings.set(a,_),this.core.expirer.set(a,w),s.activatePairing&&await this.activate({topic:a}),this.events.emit(wi.create,_),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:l})),_},this.activate=async({topic:s})=>{this.isInitialized();const a=wt(F.cjs.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:l,resolve:f,reject:w}=Cr();this.events.once(Se("pairing_ping",u),({error:_})=>{_?w(_):f()}),await l()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",Pe("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const l=I.formatJsonRpcRequest(a,u),f=await this.core.crypto.encode(s,l),w=di[a].req;return this.core.history.set(s,l),this.core.relayer.publish(s,f,w),l.id},this.sendResult=async(s,a,u)=>{const l=I.formatJsonRpcResult(s,u),f=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,s),_=di[w.request.method].res;await this.core.relayer.publish(a,f,_),await this.core.history.resolve(l)},this.sendError=async(s,a,u)=>{const l=I.formatJsonRpcError(s,u),f=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,s),_=di[w.request.method]?di[w.request.method].res:di.unregistered_method.res;await this.core.relayer.publish(a,f,_),await this.core.history.resolve(l)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Pe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Gt(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,l=(await this.core.history.get(a,u.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(wi.ping,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{I.isJsonRpcResult(a)?this.events.emit(Se("pairing_ping",u),{}):I.isJsonRpcError(a)&&this.events.emit(Se("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(wi.delete,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:l}=a;try{if(this.registeredMethods.includes(l))return;const f=Pe("WC_METHOD_UNSUPPORTED",l);await this.sendError(u,s,f),this.logger.error(f)}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Pe("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!We(s)){const{message:l}=x("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(l)}if(!T1(s.uri)){const{message:l}=x("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(l)}const u=zu(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:l}=x("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(u!=null&&u.symKey)){const{message:l}=x("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}},this.isValidPing=async s=>{if(!We(s)){const{message:u}=x("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!We(s)){const{message:u}=x("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Ne(s,!1)){const{message:a}=x("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=x("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Gt(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=x("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=I.E(r,this.name),this.pairings=new $s(this.core,this.logger,this.name,this.storagePrefix)}get context(){return I.y(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(qe.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{I.isJsonRpcRequest(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):I.isJsonRpcResponse(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(lt.expired,async t=>{const{topic:r}=Vh(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(wi.expire,{topic:r}))})}}class PE extends s0{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new H.eventsExports.EventEmitter,this.name=Y_,this.version=Z_,this.cached=[],this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const l={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:wt(F.cjs.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(Pt.created,l)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=I.isJsonRpcError(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Pt.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(Pt.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=I.E(r,this.name)}get context(){return I.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:I.formatJsonRpcRequest(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=x("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Pt.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Pt.created,t=>{const r=Pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Pt.updated,t=>{const r=Pt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Pt.deleted,t=>{const r=Pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(jr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{F.cjs.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}}class SE extends h0{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new H.eventsExports.EventEmitter,this.name=X_,this.version=eE,this.cached=[],this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),l={target:u,expiry:a};this.expirations.set(u,l),this.checkExpiry(u,l),this.events.emit(lt.created,{target:u,expiration:l})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(lt.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=I.E(r,this.name)}get context(){return I.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return u1(t);if(typeof t=="number")return h1(t);const{message:r}=x("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(lt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=x("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;F.cjs.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(lt.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(jr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(lt.created,t=>{const r=lt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(lt.expired,t=>{const r=lt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(lt.deleted,t=>{const r=lt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}}}class OE extends l0{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=ho,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Ur()||!Mr())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=No;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(l){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(l),u=await this.fetchAttestation(s.attestationId,No)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(F.cjs.ONE_SECOND*2),l=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),l.status===200?await l.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(ho))return u();window.addEventListener("message",a);const l=document.createElement("iframe");l.id=ho,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,s=u}),new Promise((u,l)=>setTimeout(()=>{window.removeEventListener("message",a),l("verify iframe load timeout")},F.cjs.toMiliseconds(F.cjs.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||$r;return tE.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${$r}`),a=$r),a},this.logger=I.E(r,this.name),this.verifyUrl=$r,this.abortController=new AbortController,this.isDevEnv=Lo()&&H.dist.process.env.IS_VITEST}get context(){return I.y(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),F.cjs.toMiliseconds(t))}}class RE extends p0{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=rE,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:l,enableEncrypted:f=!1}=s,w=`${iE}/${this.projectId}/clients`;await I.Yi(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:l,token:u,always_raw:f})})},this.logger=I.E(r,this.context)}}var AE=Object.defineProperty,uh=Object.getOwnPropertySymbols,NE=Object.prototype.hasOwnProperty,TE=Object.prototype.propertyIsEnumerable,hh=(o,t,r)=>t in o?AE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,lh=(o,t)=>{for(var r in t||(t={}))NE.call(t,r)&&hh(o,r,t[r]);if(uh)for(var r of uh(t))TE.call(t,r)&&hh(o,r,t[r]);return o};class Bo extends i0{constructor(t){super(t),this.protocol=nl,this.version=R_,this.name=Ho,this.events=new H.eventsExports.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||al,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:I.ot(I.k({level:(t==null?void 0:t.logger)||A_.logger}));this.logger=I.E(r,this.name),this.heartbeat=new jr.HeartBeat,this.crypto=new nE(this,this.logger,t==null?void 0:t.keychain),this.history=new PE(this,this.logger),this.expirer=new SE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Cw(lh(lh({},N_),t==null?void 0:t.storageOptions)),this.relayer=new wE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new IE(this,this.logger),this.verify=new OE(this.projectId||"",this.logger),this.echoClient=new RE(this.projectId||"",this.logger)}static async init(t){const r=new Bo(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(V_,s),r}get context(){return I.y(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const CE=Bo,cl="wc",ul=2,hl="client",Vo=`${cl}@${ul}:${hl}:`,po={name:hl,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},ph="WALLETCONNECT_DEEPLINK_CHOICE",$E="proposal",ll="Proposal expired",xE="session",ws=F.cjs.SEVEN_DAYS,DE="engine",gi={wc_sessionPropose:{req:{ttl:F.cjs.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:F.cjs.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:F.cjs.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:F.cjs.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1104},res:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1106},res:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:F.cjs.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:F.cjs.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:F.cjs.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:F.cjs.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1112},res:{ttl:F.cjs.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:F.cjs.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:F.cjs.THIRTY_SECONDS,prompt:!1,tag:1115}}},fo={min:F.cjs.FIVE_MINUTES,max:F.cjs.SEVEN_DAYS},qt={idle:"IDLE",active:"ACTIVE"},FE="request",jE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var qE=Object.defineProperty,UE=Object.defineProperties,ME=Object.getOwnPropertyDescriptors,dh=Object.getOwnPropertySymbols,LE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,fh=(o,t,r)=>t in o?qE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Ke=(o,t)=>{for(var r in t||(t={}))LE.call(t,r)&&fh(o,r,t[r]);if(dh)for(var r of dh(t))kE.call(t,r)&&fh(o,r,t[r]);return o},yi=(o,t)=>UE(o,ME(t));class zE extends f0{constructor(t){super(t),this.name=DE,this.events=new H.Ct,this.initialized=!1,this.ignoredPayloadTypes=[dr],this.requestQueue={state:qt.idle,queue:[]},this.sessionRequestQueue={state:qt.idle,queue:[]},this.requestQueueDelay=F.cjs.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(gi)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},F.cjs.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=yi(Ke({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:l,sessionProperties:f,relays:w}=s;let _=a,T,R=!1;if(_&&(R=this.client.core.pairing.pairings.get(_).active),!_||!R){const{topic:te,uri:re}=await this.client.core.pairing.create();_=te,T=re}const N=await this.client.core.crypto.generateKeyPair(),M=Ke({requiredNamespaces:u,optionalNamespaces:l,relays:w??[{protocol:ol}],proposer:{publicKey:N,metadata:this.client.metadata}},f&&{sessionProperties:f}),{reject:C,resolve:V,done:q}=Cr(F.cjs.FIVE_MINUTES,ll);if(this.events.once(Se("session_connect"),async({error:te,session:re})=>{if(te)C(te);else if(re){re.self.publicKey=N;const ae=yi(Ke({},re),{requiredNamespaces:re.requiredNamespaces,optionalNamespaces:re.optionalNamespaces});await this.client.session.set(re.topic,ae),await this.setExpiry(re.topic,re.expiry),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:re.peer.metadata}),V(ae)}}),!_){const{message:te}=x("NO_MATCHING_KEY",`connect() pairing topic: ${_}`);throw new Error(te)}const Y=await this.sendRequest({topic:_,method:"wc_sessionPropose",params:M}),me=wt(F.cjs.FIVE_MINUTES);return await this.setProposal(Y,Ke({id:Y,expiry:me},M)),{uri:T,approval:q}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:l}=r,f=this.client.proposal.get(s);let{pairingTopic:w,proposer:_,requiredNamespaces:T,optionalNamespaces:R}=f;w=w||"",Dr(T)||(T=S1(u,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),M=_.publicKey,C=await this.client.core.crypto.generateSharedKey(N,M);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:_.metadata}),await this.sendResult({id:s,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:N}}),await this.client.proposal.delete(s,Pe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const V=Ke({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:T,optionalNamespaces:R,pairingTopic:w,controller:{publicKey:N,metadata:this.client.metadata},expiry:wt(ws)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(C),await this.sendRequest({topic:C,method:"wc_sessionSettle",params:V,throwOnFailedPublish:!0});const q=yi(Ke({},V),{topic:C,pairingTopic:w,acknowledged:!1,self:V.controller,peer:{publicKey:_.publicKey,metadata:_.metadata},controller:N});return await this.client.session.set(C,q),await this.setExpiry(C,wt(ws)),{topic:C,acknowledged:()=>new Promise(Y=>setTimeout(()=>Y(this.client.session.get(C)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,Pe("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:l,resolve:f,reject:w}=Cr();return this.events.once(Se("session_update",u),({error:_})=>{_?w(_):f()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:l,reject:f}=Cr();return this.events.once(Se("session_extend",a),({error:w})=>{w?f(w):l()}),await this.setExpiry(s,wt(ws)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:l}=r,f=I.payloadId(),{done:w,resolve:_,reject:T}=Cr(l,"Request expired. Please try again.");return this.events.once(Se("session_request",f),({error:R,result:N})=>{R?T(R):_(N)}),await Promise.all([new Promise(async R=>{await this.sendRequest({clientRpcId:f,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:l,throwOnFailedPublish:!0}).catch(N=>T(N)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:f}),R()}),new Promise(async R=>{const N=await p1(this.client.core.storage,ph);l1({id:f,topic:u,wcDeepLink:N}),R()}),w()]).then(R=>R[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;I.isJsonRpcResult(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):I.isJsonRpcError(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:l,reject:f}=Cr();this.events.once(Se("session_ping",a),({error:w})=>{w?f(w):l()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Pe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>A1(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var l,f;return((l=u.peerMetadata)==null?void 0:l.url)&&((f=u.peerMetadata)==null?void 0:f.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Pe("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(ph).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,Pe("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,Pe("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=qt.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=gi.wc_sessionRequest.req.ttl,{id:a,topic:u,params:l,verifyContext:f}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:l,verifyContext:f}),s&&this.client.core.expirer.set(a,wt(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:l,relayRpcId:f,clientRpcId:w,throwOnFailedPublish:_}=r,T=I.formatJsonRpcRequest(a,u,w);if(Mr()&&jE.includes(a)){const M=xr(JSON.stringify(T));this.client.core.verify.register({attestationId:M})}const R=await this.client.core.crypto.encode(s,T),N=gi[a].req;return l&&(N.ttl=l),f&&(N.id=f),this.client.core.history.set(s,T),_?(N.internal=yi(Ke({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,R,N)):this.client.core.relayer.publish(s,R,N).catch(M=>this.client.logger.error(M)),T.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:l}=r,f=I.formatJsonRpcResult(s,u),w=await this.client.core.crypto.encode(a,f),_=await this.client.core.history.get(a,s),T=gi[_.request.method].res;l?(T.internal=yi(Ke({},T.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,T)):this.client.core.relayer.publish(a,w,T).catch(R=>this.client.logger.error(R)),await this.client.core.history.resolve(f)},this.sendError=async(r,s,a)=>{const u=I.formatJsonRpcError(r,a),l=await this.client.core.crypto.encode(s,u),f=await this.client.core.history.get(s,r),w=gi[f.request.method].res;this.client.core.relayer.publish(s,l,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Gt(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Gt(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===qt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=qt.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=qt.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=x("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(Ke({},s.params));const l=wt(F.cjs.FIVE_MINUTES),f=Ke({id:u,pairingTopic:r,expiry:l},a);await this.setProposal(u,f);const w=xr(JSON.stringify(s)),_=await this.getVerifyContext(w,f.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:f,verifyContext:_})}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(I.isJsonRpcResult(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const l=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const f=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:f});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const _=await this.client.core.crypto.generateSharedKey(f,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:_});const T=await this.client.core.relayer.subscribe(_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:T}),await this.client.core.pairing.activate({topic:r})}else I.isJsonRpcError(s)&&(await this.client.proposal.delete(a,Pe("USER_DISCONNECTED")),this.events.emit(Se("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:l,controller:f,expiry:w,namespaces:_,requiredNamespaces:T,optionalNamespaces:R,sessionProperties:N,pairingTopic:M}=s.params,C=Ke({topic:r,relay:l,expiry:w,namespaces:_,acknowledged:!0,pairingTopic:M,requiredNamespaces:T,optionalNamespaces:R,controller:f.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:f.publicKey,metadata:f.metadata}},N&&{sessionProperties:N});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Se("session_connect"),{session:C}),this.cleanupDuplicatePairings(C)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;I.isJsonRpcResult(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Se("session_approve",a),{})):I.isJsonRpcError(s)&&(await this.client.session.delete(r,Pe("USER_DISCONNECTED")),this.events.emit(Se("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const l=`${r}_session_update`,f=vs.get(l);if(f&&this.isRequestOutOfSync(f,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(Ke({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),vs.set(l,u)}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;I.isJsonRpcResult(s)?this.events.emit(Se("session_update",a),{}):I.isJsonRpcError(s)&&this.events.emit(Se("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,wt(ws)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;I.isJsonRpcResult(s)?this.events.emit(Se("session_extend",a),{}):I.isJsonRpcError(s)&&this.events.emit(Se("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{I.isJsonRpcResult(s)?this.events.emit(Se("session_ping",a),{}):I.isJsonRpcError(s)&&this.events.emit(Se("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(qe.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(Ke({topic:r},u));const l=xr(JSON.stringify(I.formatJsonRpcRequest("wc_sessionRequest",u,a))),f=this.client.session.get(r),w=await this.getVerifyContext(l,f.peer.metadata),_={id:a,topic:r,params:u,verifyContext:w};await this.setPendingSessionRequest(_),this.addSessionRequestToSessionRequestQueue(_),this.processSessionRequestQueue()}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;I.isJsonRpcResult(s)?this.events.emit(Se("session_request",a),{result:s.result}):I.isJsonRpcError(s)&&this.events.emit(Se("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const l=`${r}_session_event_${u.event.name}`,f=vs.get(l);if(f&&this.isRequestOutOfSync(f,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Ke({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),vs.set(l,a)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=qt.idle,this.processSessionRequestQueue()},F.cjs.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===qt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=qt.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,I.formatJsonRpcRequest("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!We(r)){const{message:w}=x("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:l,relays:f}=r;if(Je(s)||await this.isValidPairingTopic(s),!L1(f)){const{message:w}=x("MISSING_OR_INVALID",`connect() relays: ${f}`);throw new Error(w)}!Je(a)&&Dr(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!Je(u)&&Dr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),Je(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=M1(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!We(r))throw new Error(x("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:l}=r;await this.isValidProposalId(s);const f=this.client.proposal.get(s),w=Ps(a,"approve()");if(w)throw new Error(w.message);const _=Vu(f.requiredNamespaces,a,"approve()");if(_)throw new Error(_.message);if(!Ne(u,!0)){const{message:T}=x("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(T)}Je(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!We(r)){const{message:u}=x("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!z1(a)){const{message:u}=x("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!We(r)){const{message:_}=x("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(_)}const{relay:s,controller:a,namespaces:u,expiry:l}=r;if(!Wh(s)){const{message:_}=x("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(_)}const f=x1(a,"onSessionSettleRequest()");if(f)throw new Error(f.message);const w=Ps(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Gt(l)){const{message:_}=x("EXPIRED","onSessionSettleRequest()");throw new Error(_)}},this.isValidUpdate=async r=>{if(!We(r)){const{message:w}=x("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),l=Ps(a,"update()");if(l)throw new Error(l.message);const f=Vu(u.requiredNamespaces,a,"update()");if(f)throw new Error(f.message)},this.isValidExtend=async r=>{if(!We(r)){const{message:a}=x("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!We(r)){const{message:w}=x("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:s,request:a,chainId:u,expiry:l}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!Bu(f,u)){const{message:w}=x("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!H1(a)){const{message:w}=x("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!K1(f,u,a.method)){const{message:w}=x("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(l&&!Q1(l,fo)){const{message:w}=x("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${fo.min} and ${fo.max}`);throw new Error(w)}},this.isValidRespond=async r=>{var s;if(!We(r)){const{message:l}=x("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(l){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),l}if(!B1(u)){const{message:l}=x("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!We(r)){const{message:a}=x("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!We(r)){const{message:f}=x("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(f)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:l}=this.client.session.get(s);if(!Bu(l,u)){const{message:f}=x("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(f)}if(!V1(a)){const{message:f}=x("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(f)}if(!W1(l,u,a.name)){const{message:f}=x("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(f)}},this.isValidDisconnect=async r=>{if(!We(r)){const{message:a}=x("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||$r,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!Ne(a,!1)){const{message:u}=x("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=x("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(qe.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{I.isJsonRpcRequest(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):I.isJsonRpcResponse(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(lt.expired,async t=>{const{topic:r,id:s}=Vh(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,x("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(wi.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Ne(t,!1)){const{message:r}=x("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=x("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Gt(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=x("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Ne(t,!1)){const{message:r}=x("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=x("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Gt(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=x("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Ne(t,!1)){const{message:r}=x("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=x("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!k1(t)){const{message:r}=x("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=x("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Gt(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=x("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class HE extends $s{constructor(t,r){super(t,r,$E,Vo),this.core=t,this.logger=r}}class BE extends $s{constructor(t,r){super(t,r,xE,Vo),this.core=t,this.logger=r}}class VE extends $s{constructor(t,r){super(t,r,FE,Vo,s=>s.id),this.core=t,this.logger=r}}let KE=class pl extends d0{constructor(t){super(t),this.protocol=cl,this.version=ul,this.name=po.name,this.events=new H.eventsExports.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||po.name,this.metadata=(t==null?void 0:t.metadata)||s1();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:I.ot(I.k({level:(t==null?void 0:t.logger)||po.logger}));this.core=(t==null?void 0:t.core)||new CE(t),this.logger=I.E(r,this.name),this.session=new BE(this.core,this.logger),this.proposal=new HE(this.core,this.logger),this.pendingRequest=new VE(this.core,this.logger),this.engine=new zE(this)}static async init(t){const r=new pl(t);return await r.initialize(),r}get context(){return I.y(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var To={exports:{}};(function(o,t){var r=typeof self<"u"?self:H.commonjsGlobal,s=function(){function u(){this.fetch=!1,this.DOMException=r.DOMException}return u.prototype=r,new u}();(function(u){(function(l){var f={searchParams:"URLSearchParams"in u,iterable:"Symbol"in u&&"iterator"in Symbol,blob:"FileReader"in u&&"Blob"in u&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in u,arrayBuffer:"ArrayBuffer"in u};function w(E){return E&&DataView.prototype.isPrototypeOf(E)}if(f.arrayBuffer)var _=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],T=ArrayBuffer.isView||function(E){return E&&_.indexOf(Object.prototype.toString.call(E))>-1};function R(E){if(typeof E!="string"&&(E=String(E)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(E))throw new TypeError("Invalid character in header field name");return E.toLowerCase()}function N(E){return typeof E!="string"&&(E=String(E)),E}function M(E){var $={next:function(){var J=E.shift();return{done:J===void 0,value:J}}};return f.iterable&&($[Symbol.iterator]=function(){return $}),$}function C(E){this.map={},E instanceof C?E.forEach(function($,J){this.append(J,$)},this):Array.isArray(E)?E.forEach(function($){this.append($[0],$[1])},this):E&&Object.getOwnPropertyNames(E).forEach(function($){this.append($,E[$])},this)}C.prototype.append=function(E,$){E=R(E),$=N($);var J=this.map[E];this.map[E]=J?J+", "+$:$},C.prototype.delete=function(E){delete this.map[R(E)]},C.prototype.get=function(E){return E=R(E),this.has(E)?this.map[E]:null},C.prototype.has=function(E){return this.map.hasOwnProperty(R(E))},C.prototype.set=function(E,$){this.map[R(E)]=N($)},C.prototype.forEach=function(E,$){for(var J in this.map)this.map.hasOwnProperty(J)&&E.call($,this.map[J],J,this)},C.prototype.keys=function(){var E=[];return this.forEach(function($,J){E.push(J)}),M(E)},C.prototype.values=function(){var E=[];return this.forEach(function($){E.push($)}),M(E)},C.prototype.entries=function(){var E=[];return this.forEach(function($,J){E.push([J,$])}),M(E)},f.iterable&&(C.prototype[Symbol.iterator]=C.prototype.entries);function V(E){if(E.bodyUsed)return Promise.reject(new TypeError("Already read"));E.bodyUsed=!0}function q(E){return new Promise(function($,J){E.onload=function(){$(E.result)},E.onerror=function(){J(E.error)}})}function Y(E){var $=new FileReader,J=q($);return $.readAsArrayBuffer(E),J}function me(E){var $=new FileReader,J=q($);return $.readAsText(E),J}function te(E){for(var $=new Uint8Array(E),J=new Array($.length),fe=0;fe<$.length;fe++)J[fe]=String.fromCharCode($[fe]);return J.join("")}function re(E){if(E.slice)return E.slice(0);var $=new Uint8Array(E.byteLength);return $.set(new Uint8Array(E)),$.buffer}function ae(){return this.bodyUsed=!1,this._initBody=function(E){this._bodyInit=E,E?typeof E=="string"?this._bodyText=E:f.blob&&Blob.prototype.isPrototypeOf(E)?this._bodyBlob=E:f.formData&&FormData.prototype.isPrototypeOf(E)?this._bodyFormData=E:f.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)?this._bodyText=E.toString():f.arrayBuffer&&f.blob&&w(E)?(this._bodyArrayBuffer=re(E.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):f.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(E)||T(E))?this._bodyArrayBuffer=re(E):this._bodyText=E=Object.prototype.toString.call(E):this._bodyText="",this.headers.get("content-type")||(typeof E=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):f.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},f.blob&&(this.blob=function(){var E=V(this);if(E)return E;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?V(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(Y)}),this.text=function(){var E=V(this);if(E)return E;if(this._bodyBlob)return me(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(te(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},f.formData&&(this.formData=function(){return this.text().then(bt)}),this.json=function(){return this.text().then(JSON.parse)},this}var Te=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ve(E){var $=E.toUpperCase();return Te.indexOf($)>-1?$:E}function we(E,$){$=$||{};var J=$.body;if(E instanceof we){if(E.bodyUsed)throw new TypeError("Already read");this.url=E.url,this.credentials=E.credentials,$.headers||(this.headers=new C(E.headers)),this.method=E.method,this.mode=E.mode,this.signal=E.signal,!J&&E._bodyInit!=null&&(J=E._bodyInit,E.bodyUsed=!0)}else this.url=String(E);if(this.credentials=$.credentials||this.credentials||"same-origin",($.headers||!this.headers)&&(this.headers=new C($.headers)),this.method=ve($.method||this.method||"GET"),this.mode=$.mode||this.mode||null,this.signal=$.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&J)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(J)}we.prototype.clone=function(){return new we(this,{body:this._bodyInit})};function bt(E){var $=new FormData;return E.trim().split("&").forEach(function(J){if(J){var fe=J.split("="),ue=fe.shift().replace(/\+/g," "),ne=fe.join("=").replace(/\+/g," ");$.append(decodeURIComponent(ue),decodeURIComponent(ne))}}),$}function Ds(E){var $=new C,J=E.replace(/\r?\n[\t ]+/g," ");return J.split(/\r?\n/).forEach(function(fe){var ue=fe.split(":"),ne=ue.shift().trim();if(ne){var St=ue.join(":").trim();$.append(ne,St)}}),$}ae.call(we.prototype);function rt(E,$){$||($={}),this.type="default",this.status=$.status===void 0?200:$.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in $?$.statusText:"OK",this.headers=new C($.headers),this.url=$.url||"",this._initBody(E)}ae.call(rt.prototype),rt.prototype.clone=function(){return new rt(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new C(this.headers),url:this.url})},rt.error=function(){var E=new rt(null,{status:0,statusText:""});return E.type="error",E};var Fs=[301,302,303,307,308];rt.redirect=function(E,$){if(Fs.indexOf($)===-1)throw new RangeError("Invalid status code");return new rt(null,{status:$,headers:{location:E}})},l.DOMException=u.DOMException;try{new l.DOMException}catch{l.DOMException=function($,J){this.message=$,this.name=J;var fe=Error($);this.stack=fe.stack},l.DOMException.prototype=Object.create(Error.prototype),l.DOMException.prototype.constructor=l.DOMException}function kr(E,$){return new Promise(function(J,fe){var ue=new we(E,$);if(ue.signal&&ue.signal.aborted)return fe(new l.DOMException("Aborted","AbortError"));var ne=new XMLHttpRequest;function St(){ne.abort()}ne.onload=function(){var De={status:ne.status,statusText:ne.statusText,headers:Ds(ne.getAllResponseHeaders()||"")};De.url="responseURL"in ne?ne.responseURL:De.headers.get("X-Request-URL");var zr="response"in ne?ne.response:ne.responseText;J(new rt(zr,De))},ne.onerror=function(){fe(new TypeError("Network request failed"))},ne.ontimeout=function(){fe(new TypeError("Network request failed"))},ne.onabort=function(){fe(new l.DOMException("Aborted","AbortError"))},ne.open(ue.method,ue.url,!0),ue.credentials==="include"?ne.withCredentials=!0:ue.credentials==="omit"&&(ne.withCredentials=!1),"responseType"in ne&&f.blob&&(ne.responseType="blob"),ue.headers.forEach(function(De,zr){ne.setRequestHeader(zr,De)}),ue.signal&&(ue.signal.addEventListener("abort",St),ne.onreadystatechange=function(){ne.readyState===4&&ue.signal.removeEventListener("abort",St)}),ne.send(typeof ue._bodyInit>"u"?null:ue._bodyInit)})}return kr.polyfill=!0,u.fetch||(u.fetch=kr,u.Headers=C,u.Request=we,u.Response=rt),l.Headers=C,l.Request=we,l.Response=rt,l.fetch=kr,Object.defineProperty(l,"__esModule",{value:!0}),l})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var a=s;t=a.fetch,t.default=a.fetch,t.fetch=a.fetch,t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response,o.exports=t})(To,To.exports);var WE=To.exports;const gh=H.getDefaultExportFromCjs(WE),JE=o=>JSON.stringify(o,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),GE=o=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function QE(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return GE(o)}catch{return o}}function yh(o){return typeof o=="string"?o:JE(o)||""}var YE=Object.defineProperty,ZE=Object.defineProperties,XE=Object.getOwnPropertyDescriptors,mh=Object.getOwnPropertySymbols,eI=Object.prototype.hasOwnProperty,tI=Object.prototype.propertyIsEnumerable,vh=(o,t,r)=>t in o?YE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,wh=(o,t)=>{for(var r in t||(t={}))eI.call(t,r)&&vh(o,r,t[r]);if(mh)for(var r of mh(t))tI.call(t,r)&&vh(o,r,t[r]);return o},bh=(o,t)=>ZE(o,XE(t));const rI={Accept:"application/json","Content-Type":"application/json"},iI="POST",_h={headers:rI,method:iI},Eh=10;let Zt=class{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new H.eventsExports.EventEmitter,this.isAvailable=!1,this.registering=!1,!I.isHttpUrl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const r=yh(t),s=await(await gh(this.url,bh(wh({},_h),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!I.isHttpUrl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=yh({id:1,jsonrpc:"2.0",method:"test",params:[]});await gh(t,bh(wh({},_h),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?QE(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=I.formatJsonRpcError(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return I.parseConnectionError(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Eh&&this.events.setMaxListeners(Eh)}};const Ih="error",sI="wss://relay.walletconnect.com",nI="wc",oI="universal_provider",Ph=`${nI}@2:${oI}:`,aI="https://rpc.walletconnect.com/v1/",Mt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var mi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof H.dist.global<"u"?H.dist.global:typeof self<"u"?self:{},Co={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",f="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",_=500,T="__lodash_placeholder__",R=1,N=2,M=4,C=1,V=2,q=1,Y=2,me=4,te=8,re=16,ae=32,Te=64,ve=128,we=256,bt=512,Ds=30,rt="...",Fs=800,kr=16,E=1,$=2,J=3,fe=1/0,ue=9007199254740991,ne=17976931348623157e292,St=NaN,De=4294967295,zr=De-1,ml=De>>>1,vl=[["ary",ve],["bind",q],["bindKey",Y],["curry",te],["curryRight",re],["flip",bt],["partial",ae],["partialRight",Te],["rearg",we]],gr="[object Arguments]",Oi="[object Array]",wl="[object AsyncFunction]",Hr="[object Boolean]",Br="[object Date]",bl="[object DOMException]",Ri="[object Error]",Ai="[object Function]",Wo="[object GeneratorFunction]",pt="[object Map]",Vr="[object Number]",_l="[object Null]",Ot="[object Object]",Jo="[object Promise]",El="[object Proxy]",Kr="[object RegExp]",dt="[object Set]",Wr="[object String]",Ni="[object Symbol]",Il="[object Undefined]",Jr="[object WeakMap]",Pl="[object WeakSet]",Gr="[object ArrayBuffer]",yr="[object DataView]",js="[object Float32Array]",qs="[object Float64Array]",Us="[object Int8Array]",Ms="[object Int16Array]",Ls="[object Int32Array]",ks="[object Uint8Array]",zs="[object Uint8ClampedArray]",Hs="[object Uint16Array]",Bs="[object Uint32Array]",Sl=/\b__p \+= '';/g,Ol=/\b(__p \+=) '' \+/g,Rl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Go=/&(?:amp|lt|gt|quot|#39);/g,Qo=/[&<>"']/g,Al=RegExp(Go.source),Nl=RegExp(Qo.source),Tl=/<%-([\s\S]+?)%>/g,Cl=/<%([\s\S]+?)%>/g,Yo=/<%=([\s\S]+?)%>/g,$l=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xl=/^\w*$/,Dl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vs=/[\\^$.*+?()[\]{}|]/g,Fl=RegExp(Vs.source),Ks=/^\s+/,jl=/\s/,ql=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ul=/\{\n\/\* \[wrapped with (.+)\] \*/,Ml=/,? & /,Ll=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,kl=/[()=,{}\[\]\/\s]/,zl=/\\(\\)?/g,Hl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Zo=/\w*$/,Bl=/^[-+]0x[0-9a-f]+$/i,Vl=/^0b[01]+$/i,Kl=/^\[object .+?Constructor\]$/,Wl=/^0o[0-7]+$/i,Jl=/^(?:0|[1-9]\d*)$/,Gl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ti=/($^)/,Ql=/['\n\r\u2028\u2029\\]/g,Ci="\\ud800-\\udfff",Yl="\\u0300-\\u036f",Zl="\\ufe20-\\ufe2f",Xl="\\u20d0-\\u20ff",Xo=Yl+Zl+Xl,ea="\\u2700-\\u27bf",ta="a-z\\xdf-\\xf6\\xf8-\\xff",ep="\\xac\\xb1\\xd7\\xf7",tp="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rp="\\u2000-\\u206f",ip=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ra="A-Z\\xc0-\\xd6\\xd8-\\xde",ia="\\ufe0e\\ufe0f",sa=ep+tp+rp+ip,Ws="['’]",sp="["+Ci+"]",na="["+sa+"]",$i="["+Xo+"]",oa="\\d+",np="["+ea+"]",aa="["+ta+"]",ca="[^"+Ci+sa+oa+ea+ta+ra+"]",Js="\\ud83c[\\udffb-\\udfff]",op="(?:"+$i+"|"+Js+")",ua="[^"+Ci+"]",Gs="(?:\\ud83c[\\udde6-\\uddff]){2}",Qs="[\\ud800-\\udbff][\\udc00-\\udfff]",mr="["+ra+"]",ha="\\u200d",la="(?:"+aa+"|"+ca+")",ap="(?:"+mr+"|"+ca+")",pa="(?:"+Ws+"(?:d|ll|m|re|s|t|ve))?",da="(?:"+Ws+"(?:D|LL|M|RE|S|T|VE))?",fa=op+"?",ga="["+ia+"]?",cp="(?:"+ha+"(?:"+[ua,Gs,Qs].join("|")+")"+ga+fa+")*",up="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",hp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ya=ga+fa+cp,lp="(?:"+[np,Gs,Qs].join("|")+")"+ya,pp="(?:"+[ua+$i+"?",$i,Gs,Qs,sp].join("|")+")",dp=RegExp(Ws,"g"),fp=RegExp($i,"g"),Ys=RegExp(Js+"(?="+Js+")|"+pp+ya,"g"),gp=RegExp([mr+"?"+aa+"+"+pa+"(?="+[na,mr,"$"].join("|")+")",ap+"+"+da+"(?="+[na,mr+la,"$"].join("|")+")",mr+"?"+la+"+"+pa,mr+"+"+da,hp,up,oa,lp].join("|"),"g"),yp=RegExp("["+ha+Ci+Xo+ia+"]"),mp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,vp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],wp=-1,de={};de[js]=de[qs]=de[Us]=de[Ms]=de[Ls]=de[ks]=de[zs]=de[Hs]=de[Bs]=!0,de[gr]=de[Oi]=de[Gr]=de[Hr]=de[yr]=de[Br]=de[Ri]=de[Ai]=de[pt]=de[Vr]=de[Ot]=de[Kr]=de[dt]=de[Wr]=de[Jr]=!1;var he={};he[gr]=he[Oi]=he[Gr]=he[yr]=he[Hr]=he[Br]=he[js]=he[qs]=he[Us]=he[Ms]=he[Ls]=he[pt]=he[Vr]=he[Ot]=he[Kr]=he[dt]=he[Wr]=he[Ni]=he[ks]=he[zs]=he[Hs]=he[Bs]=!0,he[Ri]=he[Ai]=he[Jr]=!1;var bp={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},_p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ep={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ip={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Pp=parseFloat,Sp=parseInt,ma=typeof mi=="object"&&mi&&mi.Object===Object&&mi,Op=typeof self=="object"&&self&&self.Object===Object&&self,Ce=ma||Op||Function("return this")(),Zs=t&&!t.nodeType&&t,Xt=Zs&&!0&&o&&!o.nodeType&&o,va=Xt&&Xt.exports===Zs,Xs=va&&ma.process,it=function(){try{var m=Xt&&Xt.require&&Xt.require("util").types;return m||Xs&&Xs.binding&&Xs.binding("util")}catch{}}(),wa=it&&it.isArrayBuffer,ba=it&&it.isDate,_a=it&&it.isMap,Ea=it&&it.isRegExp,Ia=it&&it.isSet,Pa=it&&it.isTypedArray;function Ge(m,P,b){switch(b.length){case 0:return m.call(P);case 1:return m.call(P,b[0]);case 2:return m.call(P,b[0],b[1]);case 3:return m.call(P,b[0],b[1],b[2])}return m.apply(P,b)}function Rp(m,P,b,j){for(var B=-1,ie=m==null?0:m.length;++B<ie;){var Oe=m[B];P(j,Oe,b(Oe),m)}return j}function st(m,P){for(var b=-1,j=m==null?0:m.length;++b<j&&P(m[b],b,m)!==!1;);return m}function Ap(m,P){for(var b=m==null?0:m.length;b--&&P(m[b],b,m)!==!1;);return m}function Sa(m,P){for(var b=-1,j=m==null?0:m.length;++b<j;)if(!P(m[b],b,m))return!1;return!0}function Lt(m,P){for(var b=-1,j=m==null?0:m.length,B=0,ie=[];++b<j;){var Oe=m[b];P(Oe,b,m)&&(ie[B++]=Oe)}return ie}function xi(m,P){var b=m==null?0:m.length;return!!b&&vr(m,P,0)>-1}function en(m,P,b){for(var j=-1,B=m==null?0:m.length;++j<B;)if(b(P,m[j]))return!0;return!1}function ge(m,P){for(var b=-1,j=m==null?0:m.length,B=Array(j);++b<j;)B[b]=P(m[b],b,m);return B}function kt(m,P){for(var b=-1,j=P.length,B=m.length;++b<j;)m[B+b]=P[b];return m}function tn(m,P,b,j){var B=-1,ie=m==null?0:m.length;for(j&&ie&&(b=m[++B]);++B<ie;)b=P(b,m[B],B,m);return b}function Np(m,P,b,j){var B=m==null?0:m.length;for(j&&B&&(b=m[--B]);B--;)b=P(b,m[B],B,m);return b}function rn(m,P){for(var b=-1,j=m==null?0:m.length;++b<j;)if(P(m[b],b,m))return!0;return!1}var Tp=sn("length");function Cp(m){return m.split("")}function $p(m){return m.match(Ll)||[]}function Oa(m,P,b){var j;return b(m,function(B,ie,Oe){if(P(B,ie,Oe))return j=ie,!1}),j}function Di(m,P,b,j){for(var B=m.length,ie=b+(j?1:-1);j?ie--:++ie<B;)if(P(m[ie],ie,m))return ie;return-1}function vr(m,P,b){return P===P?Bp(m,P,b):Di(m,Ra,b)}function xp(m,P,b,j){for(var B=b-1,ie=m.length;++B<ie;)if(j(m[B],P))return B;return-1}function Ra(m){return m!==m}function Aa(m,P){var b=m==null?0:m.length;return b?on(m,P)/b:St}function sn(m){return function(P){return P==null?r:P[m]}}function nn(m){return function(P){return m==null?r:m[P]}}function Na(m,P,b,j,B){return B(m,function(ie,Oe,ce){b=j?(j=!1,ie):P(b,ie,Oe,ce)}),b}function Dp(m,P){var b=m.length;for(m.sort(P);b--;)m[b]=m[b].value;return m}function on(m,P){for(var b,j=-1,B=m.length;++j<B;){var ie=P(m[j]);ie!==r&&(b=b===r?ie:b+ie)}return b}function an(m,P){for(var b=-1,j=Array(m);++b<m;)j[b]=P(b);return j}function Fp(m,P){return ge(P,function(b){return[b,m[b]]})}function Ta(m){return m&&m.slice(0,Da(m)+1).replace(Ks,"")}function Qe(m){return function(P){return m(P)}}function cn(m,P){return ge(P,function(b){return m[b]})}function Qr(m,P){return m.has(P)}function Ca(m,P){for(var b=-1,j=m.length;++b<j&&vr(P,m[b],0)>-1;);return b}function $a(m,P){for(var b=m.length;b--&&vr(P,m[b],0)>-1;);return b}function jp(m,P){for(var b=m.length,j=0;b--;)m[b]===P&&++j;return j}var qp=nn(bp),Up=nn(_p);function Mp(m){return"\\"+Ip[m]}function Lp(m,P){return m==null?r:m[P]}function wr(m){return yp.test(m)}function kp(m){return mp.test(m)}function zp(m){for(var P,b=[];!(P=m.next()).done;)b.push(P.value);return b}function un(m){var P=-1,b=Array(m.size);return m.forEach(function(j,B){b[++P]=[B,j]}),b}function xa(m,P){return function(b){return m(P(b))}}function zt(m,P){for(var b=-1,j=m.length,B=0,ie=[];++b<j;){var Oe=m[b];(Oe===P||Oe===T)&&(m[b]=T,ie[B++]=b)}return ie}function Fi(m){var P=-1,b=Array(m.size);return m.forEach(function(j){b[++P]=j}),b}function Hp(m){var P=-1,b=Array(m.size);return m.forEach(function(j){b[++P]=[j,j]}),b}function Bp(m,P,b){for(var j=b-1,B=m.length;++j<B;)if(m[j]===P)return j;return-1}function Vp(m,P,b){for(var j=b+1;j--;)if(m[j]===P)return j;return j}function br(m){return wr(m)?Wp(m):Tp(m)}function ft(m){return wr(m)?Jp(m):Cp(m)}function Da(m){for(var P=m.length;P--&&jl.test(m.charAt(P)););return P}var Kp=nn(Ep);function Wp(m){for(var P=Ys.lastIndex=0;Ys.test(m);)++P;return P}function Jp(m){return m.match(Ys)||[]}function Gp(m){return m.match(gp)||[]}var Qp=function m(P){P=P==null?Ce:_r.defaults(Ce.Object(),P,_r.pick(Ce,vp));var b=P.Array,j=P.Date,B=P.Error,ie=P.Function,Oe=P.Math,ce=P.Object,hn=P.RegExp,Yp=P.String,nt=P.TypeError,ji=b.prototype,Zp=ie.prototype,Er=ce.prototype,qi=P["__core-js_shared__"],Ui=Zp.toString,oe=Er.hasOwnProperty,Xp=0,Fa=function(){var e=/[^.]+$/.exec(qi&&qi.keys&&qi.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Mi=Er.toString,ed=Ui.call(ce),td=Ce._,rd=hn("^"+Ui.call(oe).replace(Vs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Li=va?P.Buffer:r,Ht=P.Symbol,ki=P.Uint8Array,ja=Li?Li.allocUnsafe:r,zi=xa(ce.getPrototypeOf,ce),qa=ce.create,Ua=Er.propertyIsEnumerable,Hi=ji.splice,Ma=Ht?Ht.isConcatSpreadable:r,Yr=Ht?Ht.iterator:r,er=Ht?Ht.toStringTag:r,Bi=function(){try{var e=nr(ce,"defineProperty");return e({},"",{}),e}catch{}}(),id=P.clearTimeout!==Ce.clearTimeout&&P.clearTimeout,sd=j&&j.now!==Ce.Date.now&&j.now,nd=P.setTimeout!==Ce.setTimeout&&P.setTimeout,Vi=Oe.ceil,Ki=Oe.floor,ln=ce.getOwnPropertySymbols,od=Li?Li.isBuffer:r,La=P.isFinite,ad=ji.join,cd=xa(ce.keys,ce),Re=Oe.max,Fe=Oe.min,ud=j.now,hd=P.parseInt,ka=Oe.random,ld=ji.reverse,pn=nr(P,"DataView"),Zr=nr(P,"Map"),dn=nr(P,"Promise"),Ir=nr(P,"Set"),Xr=nr(P,"WeakMap"),ei=nr(ce,"create"),Wi=Xr&&new Xr,Pr={},pd=or(pn),dd=or(Zr),fd=or(dn),gd=or(Ir),yd=or(Xr),Ji=Ht?Ht.prototype:r,ti=Ji?Ji.valueOf:r,za=Ji?Ji.toString:r;function p(e){if(_e(e)&&!K(e)&&!(e instanceof X)){if(e instanceof ot)return e;if(oe.call(e,"__wrapped__"))return Hc(e)}return new ot(e)}var Sr=function(){function e(){}return function(i){if(!be(i))return{};if(qa)return qa(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function Gi(){}function ot(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:Tl,evaluate:Cl,interpolate:Yo,variable:"",imports:{_:p}},p.prototype=Gi.prototype,p.prototype.constructor=p,ot.prototype=Sr(Gi.prototype),ot.prototype.constructor=ot;function X(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=De,this.__views__=[]}function md(){var e=new X(this.__wrapped__);return e.__actions__=ze(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ze(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ze(this.__views__),e}function vd(){if(this.__filtered__){var e=new X(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function wd(){var e=this.__wrapped__.value(),i=this.__dir__,n=K(e),c=i<0,h=n?e.length:0,d=$f(0,h,this.__views__),g=d.start,y=d.end,v=y-g,S=c?y:g-1,O=this.__iteratees__,A=O.length,D=0,U=Fe(v,this.__takeCount__);if(!n||!c&&h==v&&U==v)return pc(e,this.__actions__);var k=[];e:for(;v--&&D<U;){S+=i;for(var G=-1,z=e[S];++G<A;){var Z=O[G],ee=Z.iteratee,Xe=Z.type,Le=ee(z);if(Xe==$)z=Le;else if(!Le){if(Xe==E)continue e;break e}}k[D++]=z}return k}X.prototype=Sr(Gi.prototype),X.prototype.constructor=X;function tr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function bd(){this.__data__=ei?ei(null):{},this.size=0}function _d(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Ed(e){var i=this.__data__;if(ei){var n=i[e];return n===w?r:n}return oe.call(i,e)?i[e]:r}function Id(e){var i=this.__data__;return ei?i[e]!==r:oe.call(i,e)}function Pd(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ei&&i===r?w:i,this}tr.prototype.clear=bd,tr.prototype.delete=_d,tr.prototype.get=Ed,tr.prototype.has=Id,tr.prototype.set=Pd;function Rt(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Sd(){this.__data__=[],this.size=0}function Od(e){var i=this.__data__,n=Qi(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():Hi.call(i,n,1),--this.size,!0}function Rd(e){var i=this.__data__,n=Qi(i,e);return n<0?r:i[n][1]}function Ad(e){return Qi(this.__data__,e)>-1}function Nd(e,i){var n=this.__data__,c=Qi(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}Rt.prototype.clear=Sd,Rt.prototype.delete=Od,Rt.prototype.get=Rd,Rt.prototype.has=Ad,Rt.prototype.set=Nd;function At(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Td(){this.size=0,this.__data__={hash:new tr,map:new(Zr||Rt),string:new tr}}function Cd(e){var i=cs(this,e).delete(e);return this.size-=i?1:0,i}function $d(e){return cs(this,e).get(e)}function xd(e){return cs(this,e).has(e)}function Dd(e,i){var n=cs(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}At.prototype.clear=Td,At.prototype.delete=Cd,At.prototype.get=$d,At.prototype.has=xd,At.prototype.set=Dd;function rr(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new At;++i<n;)this.add(e[i])}function Fd(e){return this.__data__.set(e,w),this}function jd(e){return this.__data__.has(e)}rr.prototype.add=rr.prototype.push=Fd,rr.prototype.has=jd;function gt(e){var i=this.__data__=new Rt(e);this.size=i.size}function qd(){this.__data__=new Rt,this.size=0}function Ud(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function Md(e){return this.__data__.get(e)}function Ld(e){return this.__data__.has(e)}function kd(e,i){var n=this.__data__;if(n instanceof Rt){var c=n.__data__;if(!Zr||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new At(c)}return n.set(e,i),this.size=n.size,this}gt.prototype.clear=qd,gt.prototype.delete=Ud,gt.prototype.get=Md,gt.prototype.has=Ld,gt.prototype.set=kd;function Ha(e,i){var n=K(e),c=!n&&ar(e),h=!n&&!c&&Jt(e),d=!n&&!c&&!h&&Nr(e),g=n||c||h||d,y=g?an(e.length,Yp):[],v=y.length;for(var S in e)(i||oe.call(e,S))&&!(g&&(S=="length"||h&&(S=="offset"||S=="parent")||d&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||$t(S,v)))&&y.push(S);return y}function Ba(e){var i=e.length;return i?e[Pn(0,i-1)]:r}function zd(e,i){return us(ze(e),ir(i,0,e.length))}function Hd(e){return us(ze(e))}function fn(e,i,n){(n!==r&&!yt(e[i],n)||n===r&&!(i in e))&&Nt(e,i,n)}function ri(e,i,n){var c=e[i];(!(oe.call(e,i)&&yt(c,n))||n===r&&!(i in e))&&Nt(e,i,n)}function Qi(e,i){for(var n=e.length;n--;)if(yt(e[n][0],i))return n;return-1}function Bd(e,i,n,c){return Bt(e,function(h,d,g){i(c,h,n(h),g)}),c}function Va(e,i){return e&&Et(i,Ae(i),e)}function Vd(e,i){return e&&Et(i,Be(i),e)}function Nt(e,i,n){i=="__proto__"&&Bi?Bi(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function gn(e,i){for(var n=-1,c=i.length,h=b(c),d=e==null;++n<c;)h[n]=d?r:Gn(e,i[n]);return h}function ir(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function at(e,i,n,c,h,d){var g,y=i&R,v=i&N,S=i&M;if(n&&(g=h?n(e,c,h,d):n(e)),g!==r)return g;if(!be(e))return e;var O=K(e);if(O){if(g=Df(e),!y)return ze(e,g)}else{var A=je(e),D=A==Ai||A==Wo;if(Jt(e))return gc(e,y);if(A==Ot||A==gr||D&&!h){if(g=v||D?{}:Dc(e),!y)return v?If(e,Vd(g,e)):Ef(e,Va(g,e))}else{if(!he[A])return h?e:{};g=Ff(e,A,y)}}d||(d=new gt);var U=d.get(e);if(U)return U;d.set(e,g),uu(e)?e.forEach(function(z){g.add(at(z,i,n,z,e,d))}):au(e)&&e.forEach(function(z,Z){g.set(Z,at(z,i,n,Z,e,d))});var k=S?v?Fn:Dn:v?Be:Ae,G=O?r:k(e);return st(G||e,function(z,Z){G&&(Z=z,z=e[Z]),ri(g,Z,at(z,i,n,Z,e,d))}),g}function Kd(e){var i=Ae(e);return function(n){return Ka(n,e,i)}}function Ka(e,i,n){var c=n.length;if(e==null)return!c;for(e=ce(e);c--;){var h=n[c],d=i[h],g=e[h];if(g===r&&!(h in e)||!d(g))return!1}return!0}function Wa(e,i,n){if(typeof e!="function")throw new nt(l);return ui(function(){e.apply(r,n)},i)}function ii(e,i,n,c){var h=-1,d=xi,g=!0,y=e.length,v=[],S=i.length;if(!y)return v;n&&(i=ge(i,Qe(n))),c?(d=en,g=!1):i.length>=a&&(d=Qr,g=!1,i=new rr(i));e:for(;++h<y;){var O=e[h],A=n==null?O:n(O);if(O=c||O!==0?O:0,g&&A===A){for(var D=S;D--;)if(i[D]===A)continue e;v.push(O)}else d(i,A,c)||v.push(O)}return v}var Bt=bc(_t),Ja=bc(mn,!0);function Wd(e,i){var n=!0;return Bt(e,function(c,h,d){return n=!!i(c,h,d),n}),n}function Yi(e,i,n){for(var c=-1,h=e.length;++c<h;){var d=e[c],g=i(d);if(g!=null&&(y===r?g===g&&!Ze(g):n(g,y)))var y=g,v=d}return v}function Jd(e,i,n,c){var h=e.length;for(n=W(n),n<0&&(n=-n>h?0:h+n),c=c===r||c>h?h:W(c),c<0&&(c+=h),c=n>c?0:lu(c);n<c;)e[n++]=i;return e}function Ga(e,i){var n=[];return Bt(e,function(c,h,d){i(c,h,d)&&n.push(c)}),n}function $e(e,i,n,c,h){var d=-1,g=e.length;for(n||(n=qf),h||(h=[]);++d<g;){var y=e[d];i>0&&n(y)?i>1?$e(y,i-1,n,c,h):kt(h,y):c||(h[h.length]=y)}return h}var yn=_c(),Qa=_c(!0);function _t(e,i){return e&&yn(e,i,Ae)}function mn(e,i){return e&&Qa(e,i,Ae)}function Zi(e,i){return Lt(i,function(n){return xt(e[n])})}function sr(e,i){i=Kt(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[It(i[n++])];return n&&n==c?e:r}function Ya(e,i,n){var c=i(e);return K(e)?c:kt(c,n(e))}function Ue(e){return e==null?e===r?Il:_l:er&&er in ce(e)?Cf(e):Bf(e)}function vn(e,i){return e>i}function Gd(e,i){return e!=null&&oe.call(e,i)}function Qd(e,i){return e!=null&&i in ce(e)}function Yd(e,i,n){return e>=Fe(i,n)&&e<Re(i,n)}function wn(e,i,n){for(var c=n?en:xi,h=e[0].length,d=e.length,g=d,y=b(d),v=1/0,S=[];g--;){var O=e[g];g&&i&&(O=ge(O,Qe(i))),v=Fe(O.length,v),y[g]=!n&&(i||h>=120&&O.length>=120)?new rr(g&&O):r}O=e[0];var A=-1,D=y[0];e:for(;++A<h&&S.length<v;){var U=O[A],k=i?i(U):U;if(U=n||U!==0?U:0,!(D?Qr(D,k):c(S,k,n))){for(g=d;--g;){var G=y[g];if(!(G?Qr(G,k):c(e[g],k,n)))continue e}D&&D.push(k),S.push(U)}}return S}function Zd(e,i,n,c){return _t(e,function(h,d,g){i(c,n(h),d,g)}),c}function si(e,i,n){i=Kt(i,e),e=Uc(e,i);var c=e==null?e:e[It(ut(i))];return c==null?r:Ge(c,e,n)}function Za(e){return _e(e)&&Ue(e)==gr}function Xd(e){return _e(e)&&Ue(e)==Gr}function ef(e){return _e(e)&&Ue(e)==Br}function ni(e,i,n,c,h){return e===i?!0:e==null||i==null||!_e(e)&&!_e(i)?e!==e&&i!==i:tf(e,i,n,c,ni,h)}function tf(e,i,n,c,h,d){var g=K(e),y=K(i),v=g?Oi:je(e),S=y?Oi:je(i);v=v==gr?Ot:v,S=S==gr?Ot:S;var O=v==Ot,A=S==Ot,D=v==S;if(D&&Jt(e)){if(!Jt(i))return!1;g=!0,O=!1}if(D&&!O)return d||(d=new gt),g||Nr(e)?Cc(e,i,n,c,h,d):Nf(e,i,v,n,c,h,d);if(!(n&C)){var U=O&&oe.call(e,"__wrapped__"),k=A&&oe.call(i,"__wrapped__");if(U||k){var G=U?e.value():e,z=k?i.value():i;return d||(d=new gt),h(G,z,n,c,d)}}return D?(d||(d=new gt),Tf(e,i,n,c,h,d)):!1}function rf(e){return _e(e)&&je(e)==pt}function bn(e,i,n,c){var h=n.length,d=h,g=!c;if(e==null)return!d;for(e=ce(e);h--;){var y=n[h];if(g&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++h<d;){y=n[h];var v=y[0],S=e[v],O=y[1];if(g&&y[2]){if(S===r&&!(v in e))return!1}else{var A=new gt;if(c)var D=c(S,O,v,e,i,A);if(!(D===r?ni(O,S,C|V,c,A):D))return!1}}return!0}function Xa(e){if(!be(e)||Mf(e))return!1;var i=xt(e)?rd:Kl;return i.test(or(e))}function sf(e){return _e(e)&&Ue(e)==Kr}function nf(e){return _e(e)&&je(e)==dt}function of(e){return _e(e)&&gs(e.length)&&!!de[Ue(e)]}function ec(e){return typeof e=="function"?e:e==null?Ve:typeof e=="object"?K(e)?ic(e[0],e[1]):rc(e):Eu(e)}function _n(e){if(!ci(e))return cd(e);var i=[];for(var n in ce(e))oe.call(e,n)&&n!="constructor"&&i.push(n);return i}function af(e){if(!be(e))return Hf(e);var i=ci(e),n=[];for(var c in e)c=="constructor"&&(i||!oe.call(e,c))||n.push(c);return n}function En(e,i){return e<i}function tc(e,i){var n=-1,c=He(e)?b(e.length):[];return Bt(e,function(h,d,g){c[++n]=i(h,d,g)}),c}function rc(e){var i=qn(e);return i.length==1&&i[0][2]?jc(i[0][0],i[0][1]):function(n){return n===e||bn(n,e,i)}}function ic(e,i){return Mn(e)&&Fc(i)?jc(It(e),i):function(n){var c=Gn(n,e);return c===r&&c===i?Qn(n,e):ni(i,c,C|V)}}function Xi(e,i,n,c,h){e!==i&&yn(i,function(d,g){if(h||(h=new gt),be(d))cf(e,i,g,n,Xi,c,h);else{var y=c?c(kn(e,g),d,g+"",e,i,h):r;y===r&&(y=d),fn(e,g,y)}},Be)}function cf(e,i,n,c,h,d,g){var y=kn(e,n),v=kn(i,n),S=g.get(v);if(S){fn(e,n,S);return}var O=d?d(y,v,n+"",e,i,g):r,A=O===r;if(A){var D=K(v),U=!D&&Jt(v),k=!D&&!U&&Nr(v);O=v,D||U||k?K(y)?O=y:Ee(y)?O=ze(y):U?(A=!1,O=gc(v,!0)):k?(A=!1,O=yc(v,!0)):O=[]:hi(v)||ar(v)?(O=y,ar(y)?O=pu(y):(!be(y)||xt(y))&&(O=Dc(v))):A=!1}A&&(g.set(v,O),h(O,v,c,d,g),g.delete(v)),fn(e,n,O)}function sc(e,i){var n=e.length;if(n)return i+=i<0?n:0,$t(i,n)?e[i]:r}function nc(e,i,n){i.length?i=ge(i,function(d){return K(d)?function(g){return sr(g,d.length===1?d[0]:d)}:d}):i=[Ve];var c=-1;i=ge(i,Qe(L()));var h=tc(e,function(d,g,y){var v=ge(i,function(S){return S(d)});return{criteria:v,index:++c,value:d}});return Dp(h,function(d,g){return _f(d,g,n)})}function uf(e,i){return oc(e,i,function(n,c){return Qn(e,c)})}function oc(e,i,n){for(var c=-1,h=i.length,d={};++c<h;){var g=i[c],y=sr(e,g);n(y,g)&&oi(d,Kt(g,e),y)}return d}function hf(e){return function(i){return sr(i,e)}}function In(e,i,n,c){var h=c?xp:vr,d=-1,g=i.length,y=e;for(e===i&&(i=ze(i)),n&&(y=ge(e,Qe(n)));++d<g;)for(var v=0,S=i[d],O=n?n(S):S;(v=h(y,O,v,c))>-1;)y!==e&&Hi.call(y,v,1),Hi.call(e,v,1);return e}function ac(e,i){for(var n=e?i.length:0,c=n-1;n--;){var h=i[n];if(n==c||h!==d){var d=h;$t(h)?Hi.call(e,h,1):Rn(e,h)}}return e}function Pn(e,i){return e+Ki(ka()*(i-e+1))}function lf(e,i,n,c){for(var h=-1,d=Re(Vi((i-e)/(n||1)),0),g=b(d);d--;)g[c?d:++h]=e,e+=n;return g}function Sn(e,i){var n="";if(!e||i<1||i>ue)return n;do i%2&&(n+=e),i=Ki(i/2),i&&(e+=e);while(i);return n}function Q(e,i){return zn(qc(e,i,Ve),e+"")}function pf(e){return Ba(Tr(e))}function df(e,i){var n=Tr(e);return us(n,ir(i,0,n.length))}function oi(e,i,n,c){if(!be(e))return e;i=Kt(i,e);for(var h=-1,d=i.length,g=d-1,y=e;y!=null&&++h<d;){var v=It(i[h]),S=n;if(v==="__proto__"||v==="constructor"||v==="prototype")return e;if(h!=g){var O=y[v];S=c?c(O,v,y):r,S===r&&(S=be(O)?O:$t(i[h+1])?[]:{})}ri(y,v,S),y=y[v]}return e}var cc=Wi?function(e,i){return Wi.set(e,i),e}:Ve,ff=Bi?function(e,i){return Bi(e,"toString",{configurable:!0,enumerable:!1,value:Zn(i),writable:!0})}:Ve;function gf(e){return us(Tr(e))}function ct(e,i,n){var c=-1,h=e.length;i<0&&(i=-i>h?0:h+i),n=n>h?h:n,n<0&&(n+=h),h=i>n?0:n-i>>>0,i>>>=0;for(var d=b(h);++c<h;)d[c]=e[c+i];return d}function yf(e,i){var n;return Bt(e,function(c,h,d){return n=i(c,h,d),!n}),!!n}function es(e,i,n){var c=0,h=e==null?c:e.length;if(typeof i=="number"&&i===i&&h<=ml){for(;c<h;){var d=c+h>>>1,g=e[d];g!==null&&!Ze(g)&&(n?g<=i:g<i)?c=d+1:h=d}return h}return On(e,i,Ve,n)}function On(e,i,n,c){var h=0,d=e==null?0:e.length;if(d===0)return 0;i=n(i);for(var g=i!==i,y=i===null,v=Ze(i),S=i===r;h<d;){var O=Ki((h+d)/2),A=n(e[O]),D=A!==r,U=A===null,k=A===A,G=Ze(A);if(g)var z=c||k;else S?z=k&&(c||D):y?z=k&&D&&(c||!U):v?z=k&&D&&!U&&(c||!G):U||G?z=!1:z=c?A<=i:A<i;z?h=O+1:d=O}return Fe(d,zr)}function uc(e,i){for(var n=-1,c=e.length,h=0,d=[];++n<c;){var g=e[n],y=i?i(g):g;if(!n||!yt(y,v)){var v=y;d[h++]=g===0?0:g}}return d}function hc(e){return typeof e=="number"?e:Ze(e)?St:+e}function Ye(e){if(typeof e=="string")return e;if(K(e))return ge(e,Ye)+"";if(Ze(e))return za?za.call(e):"";var i=e+"";return i=="0"&&1/e==-fe?"-0":i}function Vt(e,i,n){var c=-1,h=xi,d=e.length,g=!0,y=[],v=y;if(n)g=!1,h=en;else if(d>=a){var S=i?null:Rf(e);if(S)return Fi(S);g=!1,h=Qr,v=new rr}else v=i?[]:y;e:for(;++c<d;){var O=e[c],A=i?i(O):O;if(O=n||O!==0?O:0,g&&A===A){for(var D=v.length;D--;)if(v[D]===A)continue e;i&&v.push(A),y.push(O)}else h(v,A,n)||(v!==y&&v.push(A),y.push(O))}return y}function Rn(e,i){return i=Kt(i,e),e=Uc(e,i),e==null||delete e[It(ut(i))]}function lc(e,i,n,c){return oi(e,i,n(sr(e,i)),c)}function ts(e,i,n,c){for(var h=e.length,d=c?h:-1;(c?d--:++d<h)&&i(e[d],d,e););return n?ct(e,c?0:d,c?d+1:h):ct(e,c?d+1:0,c?h:d)}function pc(e,i){var n=e;return n instanceof X&&(n=n.value()),tn(i,function(c,h){return h.func.apply(h.thisArg,kt([c],h.args))},n)}function An(e,i,n){var c=e.length;if(c<2)return c?Vt(e[0]):[];for(var h=-1,d=b(c);++h<c;)for(var g=e[h],y=-1;++y<c;)y!=h&&(d[h]=ii(d[h]||g,e[y],i,n));return Vt($e(d,1),i,n)}function dc(e,i,n){for(var c=-1,h=e.length,d=i.length,g={};++c<h;){var y=c<d?i[c]:r;n(g,e[c],y)}return g}function Nn(e){return Ee(e)?e:[]}function Tn(e){return typeof e=="function"?e:Ve}function Kt(e,i){return K(e)?e:Mn(e,i)?[e]:zc(se(e))}var mf=Q;function Wt(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:ct(e,i,n)}var fc=id||function(e){return Ce.clearTimeout(e)};function gc(e,i){if(i)return e.slice();var n=e.length,c=ja?ja(n):new e.constructor(n);return e.copy(c),c}function Cn(e){var i=new e.constructor(e.byteLength);return new ki(i).set(new ki(e)),i}function vf(e,i){var n=i?Cn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function wf(e){var i=new e.constructor(e.source,Zo.exec(e));return i.lastIndex=e.lastIndex,i}function bf(e){return ti?ce(ti.call(e)):{}}function yc(e,i){var n=i?Cn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function mc(e,i){if(e!==i){var n=e!==r,c=e===null,h=e===e,d=Ze(e),g=i!==r,y=i===null,v=i===i,S=Ze(i);if(!y&&!S&&!d&&e>i||d&&g&&v&&!y&&!S||c&&g&&v||!n&&v||!h)return 1;if(!c&&!d&&!S&&e<i||S&&n&&h&&!c&&!d||y&&n&&h||!g&&h||!v)return-1}return 0}function _f(e,i,n){for(var c=-1,h=e.criteria,d=i.criteria,g=h.length,y=n.length;++c<g;){var v=mc(h[c],d[c]);if(v){if(c>=y)return v;var S=n[c];return v*(S=="desc"?-1:1)}}return e.index-i.index}function vc(e,i,n,c){for(var h=-1,d=e.length,g=n.length,y=-1,v=i.length,S=Re(d-g,0),O=b(v+S),A=!c;++y<v;)O[y]=i[y];for(;++h<g;)(A||h<d)&&(O[n[h]]=e[h]);for(;S--;)O[y++]=e[h++];return O}function wc(e,i,n,c){for(var h=-1,d=e.length,g=-1,y=n.length,v=-1,S=i.length,O=Re(d-y,0),A=b(O+S),D=!c;++h<O;)A[h]=e[h];for(var U=h;++v<S;)A[U+v]=i[v];for(;++g<y;)(D||h<d)&&(A[U+n[g]]=e[h++]);return A}function ze(e,i){var n=-1,c=e.length;for(i||(i=b(c));++n<c;)i[n]=e[n];return i}function Et(e,i,n,c){var h=!n;n||(n={});for(var d=-1,g=i.length;++d<g;){var y=i[d],v=c?c(n[y],e[y],y,n,e):r;v===r&&(v=e[y]),h?Nt(n,y,v):ri(n,y,v)}return n}function Ef(e,i){return Et(e,Un(e),i)}function If(e,i){return Et(e,$c(e),i)}function rs(e,i){return function(n,c){var h=K(n)?Rp:Bd,d=i?i():{};return h(n,e,L(c,2),d)}}function Or(e){return Q(function(i,n){var c=-1,h=n.length,d=h>1?n[h-1]:r,g=h>2?n[2]:r;for(d=e.length>3&&typeof d=="function"?(h--,d):r,g&&Me(n[0],n[1],g)&&(d=h<3?r:d,h=1),i=ce(i);++c<h;){var y=n[c];y&&e(i,y,c,d)}return i})}function bc(e,i){return function(n,c){if(n==null)return n;if(!He(n))return e(n,c);for(var h=n.length,d=i?h:-1,g=ce(n);(i?d--:++d<h)&&c(g[d],d,g)!==!1;);return n}}function _c(e){return function(i,n,c){for(var h=-1,d=ce(i),g=c(i),y=g.length;y--;){var v=g[e?y:++h];if(n(d[v],v,d)===!1)break}return i}}function Pf(e,i,n){var c=i&q,h=ai(e);function d(){var g=this&&this!==Ce&&this instanceof d?h:e;return g.apply(c?n:this,arguments)}return d}function Ec(e){return function(i){i=se(i);var n=wr(i)?ft(i):r,c=n?n[0]:i.charAt(0),h=n?Wt(n,1).join(""):i.slice(1);return c[e]()+h}}function Rr(e){return function(i){return tn(bu(wu(i).replace(dp,"")),e,"")}}function ai(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=Sr(e.prototype),c=e.apply(n,i);return be(c)?c:n}}function Sf(e,i,n){var c=ai(e);function h(){for(var d=arguments.length,g=b(d),y=d,v=Ar(h);y--;)g[y]=arguments[y];var S=d<3&&g[0]!==v&&g[d-1]!==v?[]:zt(g,v);if(d-=S.length,d<n)return Rc(e,i,is,h.placeholder,r,g,S,r,r,n-d);var O=this&&this!==Ce&&this instanceof h?c:e;return Ge(O,this,g)}return h}function Ic(e){return function(i,n,c){var h=ce(i);if(!He(i)){var d=L(n,3);i=Ae(i),n=function(y){return d(h[y],y,h)}}var g=e(i,n,c);return g>-1?h[d?i[g]:g]:r}}function Pc(e){return Ct(function(i){var n=i.length,c=n,h=ot.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new nt(l);if(h&&!g&&as(d)=="wrapper")var g=new ot([],!0)}for(c=g?c:n;++c<n;){d=i[c];var y=as(d),v=y=="wrapper"?jn(d):r;v&&Ln(v[0])&&v[1]==(ve|te|ae|we)&&!v[4].length&&v[9]==1?g=g[as(v[0])].apply(g,v[3]):g=d.length==1&&Ln(d)?g[y]():g.thru(d)}return function(){var S=arguments,O=S[0];if(g&&S.length==1&&K(O))return g.plant(O).value();for(var A=0,D=n?i[A].apply(this,S):O;++A<n;)D=i[A].call(this,D);return D}})}function is(e,i,n,c,h,d,g,y,v,S){var O=i&ve,A=i&q,D=i&Y,U=i&(te|re),k=i&bt,G=D?r:ai(e);function z(){for(var Z=arguments.length,ee=b(Z),Xe=Z;Xe--;)ee[Xe]=arguments[Xe];if(U)var Le=Ar(z),et=jp(ee,Le);if(c&&(ee=vc(ee,c,h,U)),d&&(ee=wc(ee,d,g,U)),Z-=et,U&&Z<S){var Ie=zt(ee,Le);return Rc(e,i,is,z.placeholder,n,ee,Ie,y,v,S-Z)}var mt=A?n:this,Ft=D?mt[e]:e;return Z=ee.length,y?ee=Vf(ee,y):k&&Z>1&&ee.reverse(),O&&v<Z&&(ee.length=v),this&&this!==Ce&&this instanceof z&&(Ft=G||ai(Ft)),Ft.apply(mt,ee)}return z}function Sc(e,i){return function(n,c){return Zd(n,e,i(c),{})}}function ss(e,i){return function(n,c){var h;if(n===r&&c===r)return i;if(n!==r&&(h=n),c!==r){if(h===r)return c;typeof n=="string"||typeof c=="string"?(n=Ye(n),c=Ye(c)):(n=hc(n),c=hc(c)),h=e(n,c)}return h}}function $n(e){return Ct(function(i){return i=ge(i,Qe(L())),Q(function(n){var c=this;return e(i,function(h){return Ge(h,c,n)})})})}function ns(e,i){i=i===r?" ":Ye(i);var n=i.length;if(n<2)return n?Sn(i,e):i;var c=Sn(i,Vi(e/br(i)));return wr(i)?Wt(ft(c),0,e).join(""):c.slice(0,e)}function Of(e,i,n,c){var h=i&q,d=ai(e);function g(){for(var y=-1,v=arguments.length,S=-1,O=c.length,A=b(O+v),D=this&&this!==Ce&&this instanceof g?d:e;++S<O;)A[S]=c[S];for(;v--;)A[S++]=arguments[++y];return Ge(D,h?n:this,A)}return g}function Oc(e){return function(i,n,c){return c&&typeof c!="number"&&Me(i,n,c)&&(n=c=r),i=Dt(i),n===r?(n=i,i=0):n=Dt(n),c=c===r?i<n?1:-1:Dt(c),lf(i,n,c,e)}}function os(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=ht(i),n=ht(n)),e(i,n)}}function Rc(e,i,n,c,h,d,g,y,v,S){var O=i&te,A=O?g:r,D=O?r:g,U=O?d:r,k=O?r:d;i|=O?ae:Te,i&=~(O?Te:ae),i&me||(i&=~(q|Y));var G=[e,i,h,U,A,k,D,y,v,S],z=n.apply(r,G);return Ln(e)&&Mc(z,G),z.placeholder=c,Lc(z,e,i)}function xn(e){var i=Oe[e];return function(n,c){if(n=ht(n),c=c==null?0:Fe(W(c),292),c&&La(n)){var h=(se(n)+"e").split("e"),d=i(h[0]+"e"+(+h[1]+c));return h=(se(d)+"e").split("e"),+(h[0]+"e"+(+h[1]-c))}return i(n)}}var Rf=Ir&&1/Fi(new Ir([,-0]))[1]==fe?function(e){return new Ir(e)}:to;function Ac(e){return function(i){var n=je(i);return n==pt?un(i):n==dt?Hp(i):Fp(i,e(i))}}function Tt(e,i,n,c,h,d,g,y){var v=i&Y;if(!v&&typeof e!="function")throw new nt(l);var S=c?c.length:0;if(S||(i&=~(ae|Te),c=h=r),g=g===r?g:Re(W(g),0),y=y===r?y:W(y),S-=h?h.length:0,i&Te){var O=c,A=h;c=h=r}var D=v?r:jn(e),U=[e,i,n,c,h,O,A,d,g,y];if(D&&zf(U,D),e=U[0],i=U[1],n=U[2],c=U[3],h=U[4],y=U[9]=U[9]===r?v?0:e.length:Re(U[9]-S,0),!y&&i&(te|re)&&(i&=~(te|re)),!i||i==q)var k=Pf(e,i,n);else i==te||i==re?k=Sf(e,i,y):(i==ae||i==(q|ae))&&!h.length?k=Of(e,i,n,c):k=is.apply(r,U);var G=D?cc:Mc;return Lc(G(k,U),e,i)}function Nc(e,i,n,c){return e===r||yt(e,Er[n])&&!oe.call(c,n)?i:e}function Tc(e,i,n,c,h,d){return be(e)&&be(i)&&(d.set(i,e),Xi(e,i,r,Tc,d),d.delete(i)),e}function Af(e){return hi(e)?r:e}function Cc(e,i,n,c,h,d){var g=n&C,y=e.length,v=i.length;if(y!=v&&!(g&&v>y))return!1;var S=d.get(e),O=d.get(i);if(S&&O)return S==i&&O==e;var A=-1,D=!0,U=n&V?new rr:r;for(d.set(e,i),d.set(i,e);++A<y;){var k=e[A],G=i[A];if(c)var z=g?c(G,k,A,i,e,d):c(k,G,A,e,i,d);if(z!==r){if(z)continue;D=!1;break}if(U){if(!rn(i,function(Z,ee){if(!Qr(U,ee)&&(k===Z||h(k,Z,n,c,d)))return U.push(ee)})){D=!1;break}}else if(!(k===G||h(k,G,n,c,d))){D=!1;break}}return d.delete(e),d.delete(i),D}function Nf(e,i,n,c,h,d,g){switch(n){case yr:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Gr:return!(e.byteLength!=i.byteLength||!d(new ki(e),new ki(i)));case Hr:case Br:case Vr:return yt(+e,+i);case Ri:return e.name==i.name&&e.message==i.message;case Kr:case Wr:return e==i+"";case pt:var y=un;case dt:var v=c&C;if(y||(y=Fi),e.size!=i.size&&!v)return!1;var S=g.get(e);if(S)return S==i;c|=V,g.set(e,i);var O=Cc(y(e),y(i),c,h,d,g);return g.delete(e),O;case Ni:if(ti)return ti.call(e)==ti.call(i)}return!1}function Tf(e,i,n,c,h,d){var g=n&C,y=Dn(e),v=y.length,S=Dn(i),O=S.length;if(v!=O&&!g)return!1;for(var A=v;A--;){var D=y[A];if(!(g?D in i:oe.call(i,D)))return!1}var U=d.get(e),k=d.get(i);if(U&&k)return U==i&&k==e;var G=!0;d.set(e,i),d.set(i,e);for(var z=g;++A<v;){D=y[A];var Z=e[D],ee=i[D];if(c)var Xe=g?c(ee,Z,D,i,e,d):c(Z,ee,D,e,i,d);if(!(Xe===r?Z===ee||h(Z,ee,n,c,d):Xe)){G=!1;break}z||(z=D=="constructor")}if(G&&!z){var Le=e.constructor,et=i.constructor;Le!=et&&"constructor"in e&&"constructor"in i&&!(typeof Le=="function"&&Le instanceof Le&&typeof et=="function"&&et instanceof et)&&(G=!1)}return d.delete(e),d.delete(i),G}function Ct(e){return zn(qc(e,r,Kc),e+"")}function Dn(e){return Ya(e,Ae,Un)}function Fn(e){return Ya(e,Be,$c)}var jn=Wi?function(e){return Wi.get(e)}:to;function as(e){for(var i=e.name+"",n=Pr[i],c=oe.call(Pr,i)?n.length:0;c--;){var h=n[c],d=h.func;if(d==null||d==e)return h.name}return i}function Ar(e){var i=oe.call(p,"placeholder")?p:e;return i.placeholder}function L(){var e=p.iteratee||Xn;return e=e===Xn?ec:e,arguments.length?e(arguments[0],arguments[1]):e}function cs(e,i){var n=e.__data__;return Uf(i)?n[typeof i=="string"?"string":"hash"]:n.map}function qn(e){for(var i=Ae(e),n=i.length;n--;){var c=i[n],h=e[c];i[n]=[c,h,Fc(h)]}return i}function nr(e,i){var n=Lp(e,i);return Xa(n)?n:r}function Cf(e){var i=oe.call(e,er),n=e[er];try{e[er]=r;var c=!0}catch{}var h=Mi.call(e);return c&&(i?e[er]=n:delete e[er]),h}var Un=ln?function(e){return e==null?[]:(e=ce(e),Lt(ln(e),function(i){return Ua.call(e,i)}))}:ro,$c=ln?function(e){for(var i=[];e;)kt(i,Un(e)),e=zi(e);return i}:ro,je=Ue;(pn&&je(new pn(new ArrayBuffer(1)))!=yr||Zr&&je(new Zr)!=pt||dn&&je(dn.resolve())!=Jo||Ir&&je(new Ir)!=dt||Xr&&je(new Xr)!=Jr)&&(je=function(e){var i=Ue(e),n=i==Ot?e.constructor:r,c=n?or(n):"";if(c)switch(c){case pd:return yr;case dd:return pt;case fd:return Jo;case gd:return dt;case yd:return Jr}return i});function $f(e,i,n){for(var c=-1,h=n.length;++c<h;){var d=n[c],g=d.size;switch(d.type){case"drop":e+=g;break;case"dropRight":i-=g;break;case"take":i=Fe(i,e+g);break;case"takeRight":e=Re(e,i-g);break}}return{start:e,end:i}}function xf(e){var i=e.match(Ul);return i?i[1].split(Ml):[]}function xc(e,i,n){i=Kt(i,e);for(var c=-1,h=i.length,d=!1;++c<h;){var g=It(i[c]);if(!(d=e!=null&&n(e,g)))break;e=e[g]}return d||++c!=h?d:(h=e==null?0:e.length,!!h&&gs(h)&&$t(g,h)&&(K(e)||ar(e)))}function Df(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&oe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Dc(e){return typeof e.constructor=="function"&&!ci(e)?Sr(zi(e)):{}}function Ff(e,i,n){var c=e.constructor;switch(i){case Gr:return Cn(e);case Hr:case Br:return new c(+e);case yr:return vf(e,n);case js:case qs:case Us:case Ms:case Ls:case ks:case zs:case Hs:case Bs:return yc(e,n);case pt:return new c;case Vr:case Wr:return new c(e);case Kr:return wf(e);case dt:return new c;case Ni:return bf(e)}}function jf(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(ql,`{
/* [wrapped with `+i+`] */
`)}function qf(e){return K(e)||ar(e)||!!(Ma&&e&&e[Ma])}function $t(e,i){var n=typeof e;return i=i??ue,!!i&&(n=="number"||n!="symbol"&&Jl.test(e))&&e>-1&&e%1==0&&e<i}function Me(e,i,n){if(!be(n))return!1;var c=typeof i;return(c=="number"?He(n)&&$t(i,n.length):c=="string"&&i in n)?yt(n[i],e):!1}function Mn(e,i){if(K(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ze(e)?!0:xl.test(e)||!$l.test(e)||i!=null&&e in ce(i)}function Uf(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Ln(e){var i=as(e),n=p[i];if(typeof n!="function"||!(i in X.prototype))return!1;if(e===n)return!0;var c=jn(n);return!!c&&e===c[0]}function Mf(e){return!!Fa&&Fa in e}var Lf=qi?xt:io;function ci(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||Er;return e===n}function Fc(e){return e===e&&!be(e)}function jc(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in ce(n))}}function kf(e){var i=ds(e,function(c){return n.size===_&&n.clear(),c}),n=i.cache;return i}function zf(e,i){var n=e[1],c=i[1],h=n|c,d=h<(q|Y|ve),g=c==ve&&n==te||c==ve&&n==we&&e[7].length<=i[8]||c==(ve|we)&&i[7].length<=i[8]&&n==te;if(!(d||g))return e;c&q&&(e[2]=i[2],h|=n&q?0:me);var y=i[3];if(y){var v=e[3];e[3]=v?vc(v,y,i[4]):y,e[4]=v?zt(e[3],T):i[4]}return y=i[5],y&&(v=e[5],e[5]=v?wc(v,y,i[6]):y,e[6]=v?zt(e[5],T):i[6]),y=i[7],y&&(e[7]=y),c&ve&&(e[8]=e[8]==null?i[8]:Fe(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=h,e}function Hf(e){var i=[];if(e!=null)for(var n in ce(e))i.push(n);return i}function Bf(e){return Mi.call(e)}function qc(e,i,n){return i=Re(i===r?e.length-1:i,0),function(){for(var c=arguments,h=-1,d=Re(c.length-i,0),g=b(d);++h<d;)g[h]=c[i+h];h=-1;for(var y=b(i+1);++h<i;)y[h]=c[h];return y[i]=n(g),Ge(e,this,y)}}function Uc(e,i){return i.length<2?e:sr(e,ct(i,0,-1))}function Vf(e,i){for(var n=e.length,c=Fe(i.length,n),h=ze(e);c--;){var d=i[c];e[c]=$t(d,n)?h[d]:r}return e}function kn(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Mc=kc(cc),ui=nd||function(e,i){return Ce.setTimeout(e,i)},zn=kc(ff);function Lc(e,i,n){var c=i+"";return zn(e,jf(c,Kf(xf(c),n)))}function kc(e){var i=0,n=0;return function(){var c=ud(),h=kr-(c-n);if(n=c,h>0){if(++i>=Fs)return arguments[0]}else i=0;return e.apply(r,arguments)}}function us(e,i){var n=-1,c=e.length,h=c-1;for(i=i===r?c:i;++n<i;){var d=Pn(n,h),g=e[d];e[d]=e[n],e[n]=g}return e.length=i,e}var zc=kf(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Dl,function(n,c,h,d){i.push(h?d.replace(zl,"$1"):c||n)}),i});function It(e){if(typeof e=="string"||Ze(e))return e;var i=e+"";return i=="0"&&1/e==-fe?"-0":i}function or(e){if(e!=null){try{return Ui.call(e)}catch{}try{return e+""}catch{}}return""}function Kf(e,i){return st(vl,function(n){var c="_."+n[0];i&n[1]&&!xi(e,c)&&e.push(c)}),e.sort()}function Hc(e){if(e instanceof X)return e.clone();var i=new ot(e.__wrapped__,e.__chain__);return i.__actions__=ze(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Wf(e,i,n){(n?Me(e,i,n):i===r)?i=1:i=Re(W(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var h=0,d=0,g=b(Vi(c/i));h<c;)g[d++]=ct(e,h,h+=i);return g}function Jf(e){for(var i=-1,n=e==null?0:e.length,c=0,h=[];++i<n;){var d=e[i];d&&(h[c++]=d)}return h}function Gf(){var e=arguments.length;if(!e)return[];for(var i=b(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return kt(K(n)?ze(n):[n],$e(i,1))}var Qf=Q(function(e,i){return Ee(e)?ii(e,$e(i,1,Ee,!0)):[]}),Yf=Q(function(e,i){var n=ut(i);return Ee(n)&&(n=r),Ee(e)?ii(e,$e(i,1,Ee,!0),L(n,2)):[]}),Zf=Q(function(e,i){var n=ut(i);return Ee(n)&&(n=r),Ee(e)?ii(e,$e(i,1,Ee,!0),r,n):[]});function Xf(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:W(i),ct(e,i<0?0:i,c)):[]}function eg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:W(i),i=c-i,ct(e,0,i<0?0:i)):[]}function tg(e,i){return e&&e.length?ts(e,L(i,3),!0,!0):[]}function rg(e,i){return e&&e.length?ts(e,L(i,3),!0):[]}function ig(e,i,n,c){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Me(e,i,n)&&(n=0,c=h),Jd(e,i,n,c)):[]}function Bc(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:W(n);return h<0&&(h=Re(c+h,0)),Di(e,L(i,3),h)}function Vc(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c-1;return n!==r&&(h=W(n),h=n<0?Re(c+h,0):Fe(h,c-1)),Di(e,L(i,3),h,!0)}function Kc(e){var i=e==null?0:e.length;return i?$e(e,1):[]}function sg(e){var i=e==null?0:e.length;return i?$e(e,fe):[]}function ng(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:W(i),$e(e,i)):[]}function og(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var h=e[i];c[h[0]]=h[1]}return c}function Wc(e){return e&&e.length?e[0]:r}function ag(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:W(n);return h<0&&(h=Re(c+h,0)),vr(e,i,h)}function cg(e){var i=e==null?0:e.length;return i?ct(e,0,-1):[]}var ug=Q(function(e){var i=ge(e,Nn);return i.length&&i[0]===e[0]?wn(i):[]}),hg=Q(function(e){var i=ut(e),n=ge(e,Nn);return i===ut(n)?i=r:n.pop(),n.length&&n[0]===e[0]?wn(n,L(i,2)):[]}),lg=Q(function(e){var i=ut(e),n=ge(e,Nn);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?wn(n,r,i):[]});function pg(e,i){return e==null?"":ad.call(e,i)}function ut(e){var i=e==null?0:e.length;return i?e[i-1]:r}function dg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c;return n!==r&&(h=W(n),h=h<0?Re(c+h,0):Fe(h,c-1)),i===i?Vp(e,i,h):Di(e,Ra,h,!0)}function fg(e,i){return e&&e.length?sc(e,W(i)):r}var gg=Q(Jc);function Jc(e,i){return e&&e.length&&i&&i.length?In(e,i):e}function yg(e,i,n){return e&&e.length&&i&&i.length?In(e,i,L(n,2)):e}function mg(e,i,n){return e&&e.length&&i&&i.length?In(e,i,r,n):e}var vg=Ct(function(e,i){var n=e==null?0:e.length,c=gn(e,i);return ac(e,ge(i,function(h){return $t(h,n)?+h:h}).sort(mc)),c});function wg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,h=[],d=e.length;for(i=L(i,3);++c<d;){var g=e[c];i(g,c,e)&&(n.push(g),h.push(c))}return ac(e,h),n}function Hn(e){return e==null?e:ld.call(e)}function bg(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Me(e,i,n)?(i=0,n=c):(i=i==null?0:W(i),n=n===r?c:W(n)),ct(e,i,n)):[]}function _g(e,i){return es(e,i)}function Eg(e,i,n){return On(e,i,L(n,2))}function Ig(e,i){var n=e==null?0:e.length;if(n){var c=es(e,i);if(c<n&&yt(e[c],i))return c}return-1}function Pg(e,i){return es(e,i,!0)}function Sg(e,i,n){return On(e,i,L(n,2),!0)}function Og(e,i){var n=e==null?0:e.length;if(n){var c=es(e,i,!0)-1;if(yt(e[c],i))return c}return-1}function Rg(e){return e&&e.length?uc(e):[]}function Ag(e,i){return e&&e.length?uc(e,L(i,2)):[]}function Ng(e){var i=e==null?0:e.length;return i?ct(e,1,i):[]}function Tg(e,i,n){return e&&e.length?(i=n||i===r?1:W(i),ct(e,0,i<0?0:i)):[]}function Cg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:W(i),i=c-i,ct(e,i<0?0:i,c)):[]}function $g(e,i){return e&&e.length?ts(e,L(i,3),!1,!0):[]}function xg(e,i){return e&&e.length?ts(e,L(i,3)):[]}var Dg=Q(function(e){return Vt($e(e,1,Ee,!0))}),Fg=Q(function(e){var i=ut(e);return Ee(i)&&(i=r),Vt($e(e,1,Ee,!0),L(i,2))}),jg=Q(function(e){var i=ut(e);return i=typeof i=="function"?i:r,Vt($e(e,1,Ee,!0),r,i)});function qg(e){return e&&e.length?Vt(e):[]}function Ug(e,i){return e&&e.length?Vt(e,L(i,2)):[]}function Mg(e,i){return i=typeof i=="function"?i:r,e&&e.length?Vt(e,r,i):[]}function Bn(e){if(!(e&&e.length))return[];var i=0;return e=Lt(e,function(n){if(Ee(n))return i=Re(n.length,i),!0}),an(i,function(n){return ge(e,sn(n))})}function Gc(e,i){if(!(e&&e.length))return[];var n=Bn(e);return i==null?n:ge(n,function(c){return Ge(i,r,c)})}var Lg=Q(function(e,i){return Ee(e)?ii(e,i):[]}),kg=Q(function(e){return An(Lt(e,Ee))}),zg=Q(function(e){var i=ut(e);return Ee(i)&&(i=r),An(Lt(e,Ee),L(i,2))}),Hg=Q(function(e){var i=ut(e);return i=typeof i=="function"?i:r,An(Lt(e,Ee),r,i)}),Bg=Q(Bn);function Vg(e,i){return dc(e||[],i||[],ri)}function Kg(e,i){return dc(e||[],i||[],oi)}var Wg=Q(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Gc(e,n)});function Qc(e){var i=p(e);return i.__chain__=!0,i}function Jg(e,i){return i(e),e}function hs(e,i){return i(e)}var Gg=Ct(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,h=function(d){return gn(d,e)};return i>1||this.__actions__.length||!(c instanceof X)||!$t(n)?this.thru(h):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:hs,args:[h],thisArg:r}),new ot(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(r),d}))});function Qg(){return Qc(this)}function Yg(){return new ot(this.value(),this.__chain__)}function Zg(){this.__values__===r&&(this.__values__=hu(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Xg(){return this}function ey(e){for(var i,n=this;n instanceof Gi;){var c=Hc(n);c.__index__=0,c.__values__=r,i?h.__wrapped__=c:i=c;var h=c;n=n.__wrapped__}return h.__wrapped__=e,i}function ty(){var e=this.__wrapped__;if(e instanceof X){var i=e;return this.__actions__.length&&(i=new X(this)),i=i.reverse(),i.__actions__.push({func:hs,args:[Hn],thisArg:r}),new ot(i,this.__chain__)}return this.thru(Hn)}function ry(){return pc(this.__wrapped__,this.__actions__)}var iy=rs(function(e,i,n){oe.call(e,n)?++e[n]:Nt(e,n,1)});function sy(e,i,n){var c=K(e)?Sa:Wd;return n&&Me(e,i,n)&&(i=r),c(e,L(i,3))}function ny(e,i){var n=K(e)?Lt:Ga;return n(e,L(i,3))}var oy=Ic(Bc),ay=Ic(Vc);function cy(e,i){return $e(ls(e,i),1)}function uy(e,i){return $e(ls(e,i),fe)}function hy(e,i,n){return n=n===r?1:W(n),$e(ls(e,i),n)}function Yc(e,i){var n=K(e)?st:Bt;return n(e,L(i,3))}function Zc(e,i){var n=K(e)?Ap:Ja;return n(e,L(i,3))}var ly=rs(function(e,i,n){oe.call(e,n)?e[n].push(i):Nt(e,n,[i])});function py(e,i,n,c){e=He(e)?e:Tr(e),n=n&&!c?W(n):0;var h=e.length;return n<0&&(n=Re(h+n,0)),ys(e)?n<=h&&e.indexOf(i,n)>-1:!!h&&vr(e,i,n)>-1}var dy=Q(function(e,i,n){var c=-1,h=typeof i=="function",d=He(e)?b(e.length):[];return Bt(e,function(g){d[++c]=h?Ge(i,g,n):si(g,i,n)}),d}),fy=rs(function(e,i,n){Nt(e,n,i)});function ls(e,i){var n=K(e)?ge:tc;return n(e,L(i,3))}function gy(e,i,n,c){return e==null?[]:(K(i)||(i=i==null?[]:[i]),n=c?r:n,K(n)||(n=n==null?[]:[n]),nc(e,i,n))}var yy=rs(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function my(e,i,n){var c=K(e)?tn:Na,h=arguments.length<3;return c(e,L(i,4),n,h,Bt)}function vy(e,i,n){var c=K(e)?Np:Na,h=arguments.length<3;return c(e,L(i,4),n,h,Ja)}function wy(e,i){var n=K(e)?Lt:Ga;return n(e,fs(L(i,3)))}function by(e){var i=K(e)?Ba:pf;return i(e)}function _y(e,i,n){(n?Me(e,i,n):i===r)?i=1:i=W(i);var c=K(e)?zd:df;return c(e,i)}function Ey(e){var i=K(e)?Hd:gf;return i(e)}function Iy(e){if(e==null)return 0;if(He(e))return ys(e)?br(e):e.length;var i=je(e);return i==pt||i==dt?e.size:_n(e).length}function Py(e,i,n){var c=K(e)?rn:yf;return n&&Me(e,i,n)&&(i=r),c(e,L(i,3))}var Sy=Q(function(e,i){if(e==null)return[];var n=i.length;return n>1&&Me(e,i[0],i[1])?i=[]:n>2&&Me(i[0],i[1],i[2])&&(i=[i[0]]),nc(e,$e(i,1),[])}),ps=sd||function(){return Ce.Date.now()};function Oy(e,i){if(typeof i!="function")throw new nt(l);return e=W(e),function(){if(--e<1)return i.apply(this,arguments)}}function Xc(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,Tt(e,ve,r,r,r,r,i)}function eu(e,i){var n;if(typeof i!="function")throw new nt(l);return e=W(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Vn=Q(function(e,i,n){var c=q;if(n.length){var h=zt(n,Ar(Vn));c|=ae}return Tt(e,c,i,n,h)}),tu=Q(function(e,i,n){var c=q|Y;if(n.length){var h=zt(n,Ar(tu));c|=ae}return Tt(i,c,e,n,h)});function ru(e,i,n){i=n?r:i;var c=Tt(e,te,r,r,r,r,r,i);return c.placeholder=ru.placeholder,c}function iu(e,i,n){i=n?r:i;var c=Tt(e,re,r,r,r,r,r,i);return c.placeholder=iu.placeholder,c}function su(e,i,n){var c,h,d,g,y,v,S=0,O=!1,A=!1,D=!0;if(typeof e!="function")throw new nt(l);i=ht(i)||0,be(n)&&(O=!!n.leading,A="maxWait"in n,d=A?Re(ht(n.maxWait)||0,i):d,D="trailing"in n?!!n.trailing:D);function U(Ie){var mt=c,Ft=h;return c=h=r,S=Ie,g=e.apply(Ft,mt),g}function k(Ie){return S=Ie,y=ui(Z,i),O?U(Ie):g}function G(Ie){var mt=Ie-v,Ft=Ie-S,Iu=i-mt;return A?Fe(Iu,d-Ft):Iu}function z(Ie){var mt=Ie-v,Ft=Ie-S;return v===r||mt>=i||mt<0||A&&Ft>=d}function Z(){var Ie=ps();if(z(Ie))return ee(Ie);y=ui(Z,G(Ie))}function ee(Ie){return y=r,D&&c?U(Ie):(c=h=r,g)}function Xe(){y!==r&&fc(y),S=0,c=v=h=y=r}function Le(){return y===r?g:ee(ps())}function et(){var Ie=ps(),mt=z(Ie);if(c=arguments,h=this,v=Ie,mt){if(y===r)return k(v);if(A)return fc(y),y=ui(Z,i),U(v)}return y===r&&(y=ui(Z,i)),g}return et.cancel=Xe,et.flush=Le,et}var Ry=Q(function(e,i){return Wa(e,1,i)}),Ay=Q(function(e,i,n){return Wa(e,ht(i)||0,n)});function Ny(e){return Tt(e,bt)}function ds(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new nt(l);var n=function(){var c=arguments,h=i?i.apply(this,c):c[0],d=n.cache;if(d.has(h))return d.get(h);var g=e.apply(this,c);return n.cache=d.set(h,g)||d,g};return n.cache=new(ds.Cache||At),n}ds.Cache=At;function fs(e){if(typeof e!="function")throw new nt(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Ty(e){return eu(2,e)}var Cy=mf(function(e,i){i=i.length==1&&K(i[0])?ge(i[0],Qe(L())):ge($e(i,1),Qe(L()));var n=i.length;return Q(function(c){for(var h=-1,d=Fe(c.length,n);++h<d;)c[h]=i[h].call(this,c[h]);return Ge(e,this,c)})}),Kn=Q(function(e,i){var n=zt(i,Ar(Kn));return Tt(e,ae,r,i,n)}),nu=Q(function(e,i){var n=zt(i,Ar(nu));return Tt(e,Te,r,i,n)}),$y=Ct(function(e,i){return Tt(e,we,r,r,r,i)});function xy(e,i){if(typeof e!="function")throw new nt(l);return i=i===r?i:W(i),Q(e,i)}function Dy(e,i){if(typeof e!="function")throw new nt(l);return i=i==null?0:Re(W(i),0),Q(function(n){var c=n[i],h=Wt(n,0,i);return c&&kt(h,c),Ge(e,this,h)})}function Fy(e,i,n){var c=!0,h=!0;if(typeof e!="function")throw new nt(l);return be(n)&&(c="leading"in n?!!n.leading:c,h="trailing"in n?!!n.trailing:h),su(e,i,{leading:c,maxWait:i,trailing:h})}function jy(e){return Xc(e,1)}function qy(e,i){return Kn(Tn(i),e)}function Uy(){if(!arguments.length)return[];var e=arguments[0];return K(e)?e:[e]}function My(e){return at(e,M)}function Ly(e,i){return i=typeof i=="function"?i:r,at(e,M,i)}function ky(e){return at(e,R|M)}function zy(e,i){return i=typeof i=="function"?i:r,at(e,R|M,i)}function Hy(e,i){return i==null||Ka(e,i,Ae(i))}function yt(e,i){return e===i||e!==e&&i!==i}var By=os(vn),Vy=os(function(e,i){return e>=i}),ar=Za(function(){return arguments}())?Za:function(e){return _e(e)&&oe.call(e,"callee")&&!Ua.call(e,"callee")},K=b.isArray,Ky=wa?Qe(wa):Xd;function He(e){return e!=null&&gs(e.length)&&!xt(e)}function Ee(e){return _e(e)&&He(e)}function Wy(e){return e===!0||e===!1||_e(e)&&Ue(e)==Hr}var Jt=od||io,Jy=ba?Qe(ba):ef;function Gy(e){return _e(e)&&e.nodeType===1&&!hi(e)}function Qy(e){if(e==null)return!0;if(He(e)&&(K(e)||typeof e=="string"||typeof e.splice=="function"||Jt(e)||Nr(e)||ar(e)))return!e.length;var i=je(e);if(i==pt||i==dt)return!e.size;if(ci(e))return!_n(e).length;for(var n in e)if(oe.call(e,n))return!1;return!0}function Yy(e,i){return ni(e,i)}function Zy(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?ni(e,i,r,n):!!c}function Wn(e){if(!_e(e))return!1;var i=Ue(e);return i==Ri||i==bl||typeof e.message=="string"&&typeof e.name=="string"&&!hi(e)}function Xy(e){return typeof e=="number"&&La(e)}function xt(e){if(!be(e))return!1;var i=Ue(e);return i==Ai||i==Wo||i==wl||i==El}function ou(e){return typeof e=="number"&&e==W(e)}function gs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ue}function be(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function _e(e){return e!=null&&typeof e=="object"}var au=_a?Qe(_a):rf;function em(e,i){return e===i||bn(e,i,qn(i))}function tm(e,i,n){return n=typeof n=="function"?n:r,bn(e,i,qn(i),n)}function rm(e){return cu(e)&&e!=+e}function im(e){if(Lf(e))throw new B(u);return Xa(e)}function sm(e){return e===null}function nm(e){return e==null}function cu(e){return typeof e=="number"||_e(e)&&Ue(e)==Vr}function hi(e){if(!_e(e)||Ue(e)!=Ot)return!1;var i=zi(e);if(i===null)return!0;var n=oe.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&Ui.call(n)==ed}var Jn=Ea?Qe(Ea):sf;function om(e){return ou(e)&&e>=-ue&&e<=ue}var uu=Ia?Qe(Ia):nf;function ys(e){return typeof e=="string"||!K(e)&&_e(e)&&Ue(e)==Wr}function Ze(e){return typeof e=="symbol"||_e(e)&&Ue(e)==Ni}var Nr=Pa?Qe(Pa):of;function am(e){return e===r}function cm(e){return _e(e)&&je(e)==Jr}function um(e){return _e(e)&&Ue(e)==Pl}var hm=os(En),lm=os(function(e,i){return e<=i});function hu(e){if(!e)return[];if(He(e))return ys(e)?ft(e):ze(e);if(Yr&&e[Yr])return zp(e[Yr]());var i=je(e),n=i==pt?un:i==dt?Fi:Tr;return n(e)}function Dt(e){if(!e)return e===0?e:0;if(e=ht(e),e===fe||e===-fe){var i=e<0?-1:1;return i*ne}return e===e?e:0}function W(e){var i=Dt(e),n=i%1;return i===i?n?i-n:i:0}function lu(e){return e?ir(W(e),0,De):0}function ht(e){if(typeof e=="number")return e;if(Ze(e))return St;if(be(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=be(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Ta(e);var n=Vl.test(e);return n||Wl.test(e)?Sp(e.slice(2),n?2:8):Bl.test(e)?St:+e}function pu(e){return Et(e,Be(e))}function pm(e){return e?ir(W(e),-ue,ue):e===0?e:0}function se(e){return e==null?"":Ye(e)}var dm=Or(function(e,i){if(ci(i)||He(i)){Et(i,Ae(i),e);return}for(var n in i)oe.call(i,n)&&ri(e,n,i[n])}),du=Or(function(e,i){Et(i,Be(i),e)}),ms=Or(function(e,i,n,c){Et(i,Be(i),e,c)}),fm=Or(function(e,i,n,c){Et(i,Ae(i),e,c)}),gm=Ct(gn);function ym(e,i){var n=Sr(e);return i==null?n:Va(n,i)}var mm=Q(function(e,i){e=ce(e);var n=-1,c=i.length,h=c>2?i[2]:r;for(h&&Me(i[0],i[1],h)&&(c=1);++n<c;)for(var d=i[n],g=Be(d),y=-1,v=g.length;++y<v;){var S=g[y],O=e[S];(O===r||yt(O,Er[S])&&!oe.call(e,S))&&(e[S]=d[S])}return e}),vm=Q(function(e){return e.push(r,Tc),Ge(fu,r,e)});function wm(e,i){return Oa(e,L(i,3),_t)}function bm(e,i){return Oa(e,L(i,3),mn)}function _m(e,i){return e==null?e:yn(e,L(i,3),Be)}function Em(e,i){return e==null?e:Qa(e,L(i,3),Be)}function Im(e,i){return e&&_t(e,L(i,3))}function Pm(e,i){return e&&mn(e,L(i,3))}function Sm(e){return e==null?[]:Zi(e,Ae(e))}function Om(e){return e==null?[]:Zi(e,Be(e))}function Gn(e,i,n){var c=e==null?r:sr(e,i);return c===r?n:c}function Rm(e,i){return e!=null&&xc(e,i,Gd)}function Qn(e,i){return e!=null&&xc(e,i,Qd)}var Am=Sc(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Mi.call(i)),e[i]=n},Zn(Ve)),Nm=Sc(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Mi.call(i)),oe.call(e,i)?e[i].push(n):e[i]=[n]},L),Tm=Q(si);function Ae(e){return He(e)?Ha(e):_n(e)}function Be(e){return He(e)?Ha(e,!0):af(e)}function Cm(e,i){var n={};return i=L(i,3),_t(e,function(c,h,d){Nt(n,i(c,h,d),c)}),n}function $m(e,i){var n={};return i=L(i,3),_t(e,function(c,h,d){Nt(n,h,i(c,h,d))}),n}var xm=Or(function(e,i,n){Xi(e,i,n)}),fu=Or(function(e,i,n,c){Xi(e,i,n,c)}),Dm=Ct(function(e,i){var n={};if(e==null)return n;var c=!1;i=ge(i,function(d){return d=Kt(d,e),c||(c=d.length>1),d}),Et(e,Fn(e),n),c&&(n=at(n,R|N|M,Af));for(var h=i.length;h--;)Rn(n,i[h]);return n});function Fm(e,i){return gu(e,fs(L(i)))}var jm=Ct(function(e,i){return e==null?{}:uf(e,i)});function gu(e,i){if(e==null)return{};var n=ge(Fn(e),function(c){return[c]});return i=L(i),oc(e,n,function(c,h){return i(c,h[0])})}function qm(e,i,n){i=Kt(i,e);var c=-1,h=i.length;for(h||(h=1,e=r);++c<h;){var d=e==null?r:e[It(i[c])];d===r&&(c=h,d=n),e=xt(d)?d.call(e):d}return e}function Um(e,i,n){return e==null?e:oi(e,i,n)}function Mm(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:oi(e,i,n,c)}var yu=Ac(Ae),mu=Ac(Be);function Lm(e,i,n){var c=K(e),h=c||Jt(e)||Nr(e);if(i=L(i,4),n==null){var d=e&&e.constructor;h?n=c?new d:[]:be(e)?n=xt(d)?Sr(zi(e)):{}:n={}}return(h?st:_t)(e,function(g,y,v){return i(n,g,y,v)}),n}function km(e,i){return e==null?!0:Rn(e,i)}function zm(e,i,n){return e==null?e:lc(e,i,Tn(n))}function Hm(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:lc(e,i,Tn(n),c)}function Tr(e){return e==null?[]:cn(e,Ae(e))}function Bm(e){return e==null?[]:cn(e,Be(e))}function Vm(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=ht(n),n=n===n?n:0),i!==r&&(i=ht(i),i=i===i?i:0),ir(ht(e),i,n)}function Km(e,i,n){return i=Dt(i),n===r?(n=i,i=0):n=Dt(n),e=ht(e),Yd(e,i,n)}function Wm(e,i,n){if(n&&typeof n!="boolean"&&Me(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=Dt(e),i===r?(i=e,e=0):i=Dt(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var h=ka();return Fe(e+h*(i-e+Pp("1e-"+((h+"").length-1))),i)}return Pn(e,i)}var Jm=Rr(function(e,i,n){return i=i.toLowerCase(),e+(n?vu(i):i)});function vu(e){return Yn(se(e).toLowerCase())}function wu(e){return e=se(e),e&&e.replace(Gl,qp).replace(fp,"")}function Gm(e,i,n){e=se(e),i=Ye(i);var c=e.length;n=n===r?c:ir(W(n),0,c);var h=n;return n-=i.length,n>=0&&e.slice(n,h)==i}function Qm(e){return e=se(e),e&&Nl.test(e)?e.replace(Qo,Up):e}function Ym(e){return e=se(e),e&&Fl.test(e)?e.replace(Vs,"\\$&"):e}var Zm=Rr(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),Xm=Rr(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),ev=Ec("toLowerCase");function tv(e,i,n){e=se(e),i=W(i);var c=i?br(e):0;if(!i||c>=i)return e;var h=(i-c)/2;return ns(Ki(h),n)+e+ns(Vi(h),n)}function rv(e,i,n){e=se(e),i=W(i);var c=i?br(e):0;return i&&c<i?e+ns(i-c,n):e}function iv(e,i,n){e=se(e),i=W(i);var c=i?br(e):0;return i&&c<i?ns(i-c,n)+e:e}function sv(e,i,n){return n||i==null?i=0:i&&(i=+i),hd(se(e).replace(Ks,""),i||0)}function nv(e,i,n){return(n?Me(e,i,n):i===r)?i=1:i=W(i),Sn(se(e),i)}function ov(){var e=arguments,i=se(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var av=Rr(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function cv(e,i,n){return n&&typeof n!="number"&&Me(e,i,n)&&(i=n=r),n=n===r?De:n>>>0,n?(e=se(e),e&&(typeof i=="string"||i!=null&&!Jn(i))&&(i=Ye(i),!i&&wr(e))?Wt(ft(e),0,n):e.split(i,n)):[]}var uv=Rr(function(e,i,n){return e+(n?" ":"")+Yn(i)});function hv(e,i,n){return e=se(e),n=n==null?0:ir(W(n),0,e.length),i=Ye(i),e.slice(n,n+i.length)==i}function lv(e,i,n){var c=p.templateSettings;n&&Me(e,i,n)&&(i=r),e=se(e),i=ms({},i,c,Nc);var h=ms({},i.imports,c.imports,Nc),d=Ae(h),g=cn(h,d),y,v,S=0,O=i.interpolate||Ti,A="__p += '",D=hn((i.escape||Ti).source+"|"+O.source+"|"+(O===Yo?Hl:Ti).source+"|"+(i.evaluate||Ti).source+"|$","g"),U="//# sourceURL="+(oe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++wp+"]")+`
`;e.replace(D,function(z,Z,ee,Xe,Le,et){return ee||(ee=Xe),A+=e.slice(S,et).replace(Ql,Mp),Z&&(y=!0,A+=`' +
__e(`+Z+`) +
'`),Le&&(v=!0,A+=`';
`+Le+`;
__p += '`),ee&&(A+=`' +
((__t = (`+ee+`)) == null ? '' : __t) +
'`),S=et+z.length,z}),A+=`';
`;var k=oe.call(i,"variable")&&i.variable;if(!k)A=`with (obj) {
`+A+`
}
`;else if(kl.test(k))throw new B(f);A=(v?A.replace(Sl,""):A).replace(Ol,"$1").replace(Rl,"$1;"),A="function("+(k||"obj")+`) {
`+(k?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(v?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+A+`return __p
}`;var G=_u(function(){return ie(d,U+"return "+A).apply(r,g)});if(G.source=A,Wn(G))throw G;return G}function pv(e){return se(e).toLowerCase()}function dv(e){return se(e).toUpperCase()}function fv(e,i,n){if(e=se(e),e&&(n||i===r))return Ta(e);if(!e||!(i=Ye(i)))return e;var c=ft(e),h=ft(i),d=Ca(c,h),g=$a(c,h)+1;return Wt(c,d,g).join("")}function gv(e,i,n){if(e=se(e),e&&(n||i===r))return e.slice(0,Da(e)+1);if(!e||!(i=Ye(i)))return e;var c=ft(e),h=$a(c,ft(i))+1;return Wt(c,0,h).join("")}function yv(e,i,n){if(e=se(e),e&&(n||i===r))return e.replace(Ks,"");if(!e||!(i=Ye(i)))return e;var c=ft(e),h=Ca(c,ft(i));return Wt(c,h).join("")}function mv(e,i){var n=Ds,c=rt;if(be(i)){var h="separator"in i?i.separator:h;n="length"in i?W(i.length):n,c="omission"in i?Ye(i.omission):c}e=se(e);var d=e.length;if(wr(e)){var g=ft(e);d=g.length}if(n>=d)return e;var y=n-br(c);if(y<1)return c;var v=g?Wt(g,0,y).join(""):e.slice(0,y);if(h===r)return v+c;if(g&&(y+=v.length-y),Jn(h)){if(e.slice(y).search(h)){var S,O=v;for(h.global||(h=hn(h.source,se(Zo.exec(h))+"g")),h.lastIndex=0;S=h.exec(O);)var A=S.index;v=v.slice(0,A===r?y:A)}}else if(e.indexOf(Ye(h),y)!=y){var D=v.lastIndexOf(h);D>-1&&(v=v.slice(0,D))}return v+c}function vv(e){return e=se(e),e&&Al.test(e)?e.replace(Go,Kp):e}var wv=Rr(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),Yn=Ec("toUpperCase");function bu(e,i,n){return e=se(e),i=n?r:i,i===r?kp(e)?Gp(e):$p(e):e.match(i)||[]}var _u=Q(function(e,i){try{return Ge(e,r,i)}catch(n){return Wn(n)?n:new B(n)}}),bv=Ct(function(e,i){return st(i,function(n){n=It(n),Nt(e,n,Vn(e[n],e))}),e});function _v(e){var i=e==null?0:e.length,n=L();return e=i?ge(e,function(c){if(typeof c[1]!="function")throw new nt(l);return[n(c[0]),c[1]]}):[],Q(function(c){for(var h=-1;++h<i;){var d=e[h];if(Ge(d[0],this,c))return Ge(d[1],this,c)}})}function Ev(e){return Kd(at(e,R))}function Zn(e){return function(){return e}}function Iv(e,i){return e==null||e!==e?i:e}var Pv=Pc(),Sv=Pc(!0);function Ve(e){return e}function Xn(e){return ec(typeof e=="function"?e:at(e,R))}function Ov(e){return rc(at(e,R))}function Rv(e,i){return ic(e,at(i,R))}var Av=Q(function(e,i){return function(n){return si(n,e,i)}}),Nv=Q(function(e,i){return function(n){return si(e,n,i)}});function eo(e,i,n){var c=Ae(i),h=Zi(i,c);n==null&&!(be(i)&&(h.length||!c.length))&&(n=i,i=e,e=this,h=Zi(i,Ae(i)));var d=!(be(n)&&"chain"in n)||!!n.chain,g=xt(e);return st(h,function(y){var v=i[y];e[y]=v,g&&(e.prototype[y]=function(){var S=this.__chain__;if(d||S){var O=e(this.__wrapped__),A=O.__actions__=ze(this.__actions__);return A.push({func:v,args:arguments,thisArg:e}),O.__chain__=S,O}return v.apply(e,kt([this.value()],arguments))})}),e}function Tv(){return Ce._===this&&(Ce._=td),this}function to(){}function Cv(e){return e=W(e),Q(function(i){return sc(i,e)})}var $v=$n(ge),xv=$n(Sa),Dv=$n(rn);function Eu(e){return Mn(e)?sn(It(e)):hf(e)}function Fv(e){return function(i){return e==null?r:sr(e,i)}}var jv=Oc(),qv=Oc(!0);function ro(){return[]}function io(){return!1}function Uv(){return{}}function Mv(){return""}function Lv(){return!0}function kv(e,i){if(e=W(e),e<1||e>ue)return[];var n=De,c=Fe(e,De);i=L(i),e-=De;for(var h=an(c,i);++n<e;)i(n);return h}function zv(e){return K(e)?ge(e,It):Ze(e)?[e]:ze(zc(se(e)))}function Hv(e){var i=++Xp;return se(e)+i}var Bv=ss(function(e,i){return e+i},0),Vv=xn("ceil"),Kv=ss(function(e,i){return e/i},1),Wv=xn("floor");function Jv(e){return e&&e.length?Yi(e,Ve,vn):r}function Gv(e,i){return e&&e.length?Yi(e,L(i,2),vn):r}function Qv(e){return Aa(e,Ve)}function Yv(e,i){return Aa(e,L(i,2))}function Zv(e){return e&&e.length?Yi(e,Ve,En):r}function Xv(e,i){return e&&e.length?Yi(e,L(i,2),En):r}var ew=ss(function(e,i){return e*i},1),tw=xn("round"),rw=ss(function(e,i){return e-i},0);function iw(e){return e&&e.length?on(e,Ve):0}function sw(e,i){return e&&e.length?on(e,L(i,2)):0}return p.after=Oy,p.ary=Xc,p.assign=dm,p.assignIn=du,p.assignInWith=ms,p.assignWith=fm,p.at=gm,p.before=eu,p.bind=Vn,p.bindAll=bv,p.bindKey=tu,p.castArray=Uy,p.chain=Qc,p.chunk=Wf,p.compact=Jf,p.concat=Gf,p.cond=_v,p.conforms=Ev,p.constant=Zn,p.countBy=iy,p.create=ym,p.curry=ru,p.curryRight=iu,p.debounce=su,p.defaults=mm,p.defaultsDeep=vm,p.defer=Ry,p.delay=Ay,p.difference=Qf,p.differenceBy=Yf,p.differenceWith=Zf,p.drop=Xf,p.dropRight=eg,p.dropRightWhile=tg,p.dropWhile=rg,p.fill=ig,p.filter=ny,p.flatMap=cy,p.flatMapDeep=uy,p.flatMapDepth=hy,p.flatten=Kc,p.flattenDeep=sg,p.flattenDepth=ng,p.flip=Ny,p.flow=Pv,p.flowRight=Sv,p.fromPairs=og,p.functions=Sm,p.functionsIn=Om,p.groupBy=ly,p.initial=cg,p.intersection=ug,p.intersectionBy=hg,p.intersectionWith=lg,p.invert=Am,p.invertBy=Nm,p.invokeMap=dy,p.iteratee=Xn,p.keyBy=fy,p.keys=Ae,p.keysIn=Be,p.map=ls,p.mapKeys=Cm,p.mapValues=$m,p.matches=Ov,p.matchesProperty=Rv,p.memoize=ds,p.merge=xm,p.mergeWith=fu,p.method=Av,p.methodOf=Nv,p.mixin=eo,p.negate=fs,p.nthArg=Cv,p.omit=Dm,p.omitBy=Fm,p.once=Ty,p.orderBy=gy,p.over=$v,p.overArgs=Cy,p.overEvery=xv,p.overSome=Dv,p.partial=Kn,p.partialRight=nu,p.partition=yy,p.pick=jm,p.pickBy=gu,p.property=Eu,p.propertyOf=Fv,p.pull=gg,p.pullAll=Jc,p.pullAllBy=yg,p.pullAllWith=mg,p.pullAt=vg,p.range=jv,p.rangeRight=qv,p.rearg=$y,p.reject=wy,p.remove=wg,p.rest=xy,p.reverse=Hn,p.sampleSize=_y,p.set=Um,p.setWith=Mm,p.shuffle=Ey,p.slice=bg,p.sortBy=Sy,p.sortedUniq=Rg,p.sortedUniqBy=Ag,p.split=cv,p.spread=Dy,p.tail=Ng,p.take=Tg,p.takeRight=Cg,p.takeRightWhile=$g,p.takeWhile=xg,p.tap=Jg,p.throttle=Fy,p.thru=hs,p.toArray=hu,p.toPairs=yu,p.toPairsIn=mu,p.toPath=zv,p.toPlainObject=pu,p.transform=Lm,p.unary=jy,p.union=Dg,p.unionBy=Fg,p.unionWith=jg,p.uniq=qg,p.uniqBy=Ug,p.uniqWith=Mg,p.unset=km,p.unzip=Bn,p.unzipWith=Gc,p.update=zm,p.updateWith=Hm,p.values=Tr,p.valuesIn=Bm,p.without=Lg,p.words=bu,p.wrap=qy,p.xor=kg,p.xorBy=zg,p.xorWith=Hg,p.zip=Bg,p.zipObject=Vg,p.zipObjectDeep=Kg,p.zipWith=Wg,p.entries=yu,p.entriesIn=mu,p.extend=du,p.extendWith=ms,eo(p,p),p.add=Bv,p.attempt=_u,p.camelCase=Jm,p.capitalize=vu,p.ceil=Vv,p.clamp=Vm,p.clone=My,p.cloneDeep=ky,p.cloneDeepWith=zy,p.cloneWith=Ly,p.conformsTo=Hy,p.deburr=wu,p.defaultTo=Iv,p.divide=Kv,p.endsWith=Gm,p.eq=yt,p.escape=Qm,p.escapeRegExp=Ym,p.every=sy,p.find=oy,p.findIndex=Bc,p.findKey=wm,p.findLast=ay,p.findLastIndex=Vc,p.findLastKey=bm,p.floor=Wv,p.forEach=Yc,p.forEachRight=Zc,p.forIn=_m,p.forInRight=Em,p.forOwn=Im,p.forOwnRight=Pm,p.get=Gn,p.gt=By,p.gte=Vy,p.has=Rm,p.hasIn=Qn,p.head=Wc,p.identity=Ve,p.includes=py,p.indexOf=ag,p.inRange=Km,p.invoke=Tm,p.isArguments=ar,p.isArray=K,p.isArrayBuffer=Ky,p.isArrayLike=He,p.isArrayLikeObject=Ee,p.isBoolean=Wy,p.isBuffer=Jt,p.isDate=Jy,p.isElement=Gy,p.isEmpty=Qy,p.isEqual=Yy,p.isEqualWith=Zy,p.isError=Wn,p.isFinite=Xy,p.isFunction=xt,p.isInteger=ou,p.isLength=gs,p.isMap=au,p.isMatch=em,p.isMatchWith=tm,p.isNaN=rm,p.isNative=im,p.isNil=nm,p.isNull=sm,p.isNumber=cu,p.isObject=be,p.isObjectLike=_e,p.isPlainObject=hi,p.isRegExp=Jn,p.isSafeInteger=om,p.isSet=uu,p.isString=ys,p.isSymbol=Ze,p.isTypedArray=Nr,p.isUndefined=am,p.isWeakMap=cm,p.isWeakSet=um,p.join=pg,p.kebabCase=Zm,p.last=ut,p.lastIndexOf=dg,p.lowerCase=Xm,p.lowerFirst=ev,p.lt=hm,p.lte=lm,p.max=Jv,p.maxBy=Gv,p.mean=Qv,p.meanBy=Yv,p.min=Zv,p.minBy=Xv,p.stubArray=ro,p.stubFalse=io,p.stubObject=Uv,p.stubString=Mv,p.stubTrue=Lv,p.multiply=ew,p.nth=fg,p.noConflict=Tv,p.noop=to,p.now=ps,p.pad=tv,p.padEnd=rv,p.padStart=iv,p.parseInt=sv,p.random=Wm,p.reduce=my,p.reduceRight=vy,p.repeat=nv,p.replace=ov,p.result=qm,p.round=tw,p.runInContext=m,p.sample=by,p.size=Iy,p.snakeCase=av,p.some=Py,p.sortedIndex=_g,p.sortedIndexBy=Eg,p.sortedIndexOf=Ig,p.sortedLastIndex=Pg,p.sortedLastIndexBy=Sg,p.sortedLastIndexOf=Og,p.startCase=uv,p.startsWith=hv,p.subtract=rw,p.sum=iw,p.sumBy=sw,p.template=lv,p.times=kv,p.toFinite=Dt,p.toInteger=W,p.toLength=lu,p.toLower=pv,p.toNumber=ht,p.toSafeInteger=pm,p.toString=se,p.toUpper=dv,p.trim=fv,p.trimEnd=gv,p.trimStart=yv,p.truncate=mv,p.unescape=vv,p.uniqueId=Hv,p.upperCase=wv,p.upperFirst=Yn,p.each=Yc,p.eachRight=Zc,p.first=Wc,eo(p,function(){var e={};return _t(p,function(i,n){oe.call(p.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),p.VERSION=s,st(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),st(["drop","take"],function(e,i){X.prototype[e]=function(n){n=n===r?1:Re(W(n),0);var c=this.__filtered__&&!i?new X(this):this.clone();return c.__filtered__?c.__takeCount__=Fe(n,c.__takeCount__):c.__views__.push({size:Fe(n,De),type:e+(c.__dir__<0?"Right":"")}),c},X.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),st(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==E||n==J;X.prototype[e]=function(h){var d=this.clone();return d.__iteratees__.push({iteratee:L(h,3),type:n}),d.__filtered__=d.__filtered__||c,d}}),st(["head","last"],function(e,i){var n="take"+(i?"Right":"");X.prototype[e]=function(){return this[n](1).value()[0]}}),st(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");X.prototype[e]=function(){return this.__filtered__?new X(this):this[n](1)}}),X.prototype.compact=function(){return this.filter(Ve)},X.prototype.find=function(e){return this.filter(e).head()},X.prototype.findLast=function(e){return this.reverse().find(e)},X.prototype.invokeMap=Q(function(e,i){return typeof e=="function"?new X(this):this.map(function(n){return si(n,e,i)})}),X.prototype.reject=function(e){return this.filter(fs(L(e)))},X.prototype.slice=function(e,i){e=W(e);var n=this;return n.__filtered__&&(e>0||i<0)?new X(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=W(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},X.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},X.prototype.toArray=function(){return this.take(De)},_t(X.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),h=p[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);h&&(p.prototype[i]=function(){var g=this.__wrapped__,y=c?[1]:arguments,v=g instanceof X,S=y[0],O=v||K(g),A=function(Z){var ee=h.apply(p,kt([Z],y));return c&&D?ee[0]:ee};O&&n&&typeof S=="function"&&S.length!=1&&(v=O=!1);var D=this.__chain__,U=!!this.__actions__.length,k=d&&!D,G=v&&!U;if(!d&&O){g=G?g:new X(this);var z=e.apply(g,y);return z.__actions__.push({func:hs,args:[A],thisArg:r}),new ot(z,D)}return k&&G?e.apply(this,y):(z=this.thru(A),k?c?z.value()[0]:z.value():z)})}),st(["pop","push","shift","sort","splice","unshift"],function(e){var i=ji[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var h=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(K(d)?d:[],h)}return this[n](function(g){return i.apply(K(g)?g:[],h)})}}),_t(X.prototype,function(e,i){var n=p[i];if(n){var c=n.name+"";oe.call(Pr,c)||(Pr[c]=[]),Pr[c].push({name:i,func:n})}}),Pr[is(r,Y).name]=[{name:"wrapper",func:r}],X.prototype.clone=md,X.prototype.reverse=vd,X.prototype.value=wd,p.prototype.at=Gg,p.prototype.chain=Qg,p.prototype.commit=Yg,p.prototype.next=Zg,p.prototype.plant=ey,p.prototype.reverse=ty,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=ry,p.prototype.first=p.prototype.head,Yr&&(p.prototype[Yr]=Xg),p},_r=Qp();Xt?((Xt.exports=_r)._=_r,Zs._=_r):Ce._=_r}).call(mi)})(Co,Co.exports);var cI=Object.defineProperty,uI=Object.defineProperties,hI=Object.getOwnPropertyDescriptors,Sh=Object.getOwnPropertySymbols,lI=Object.prototype.hasOwnProperty,pI=Object.prototype.propertyIsEnumerable,Oh=(o,t,r)=>t in o?cI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,bs=(o,t)=>{for(var r in t||(t={}))lI.call(t,r)&&Oh(o,r,t[r]);if(Sh)for(var r of Sh(t))pI.call(t,r)&&Oh(o,r,t[r]);return o},dI=(o,t)=>uI(o,hI(t));function Yt(o,t,r){var s;const a=k0(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${aI}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function fr(o){return o.includes(":")?o.split(":")[1]:o}function dl(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function fI(o,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function gI(o={},t={}){const r=Rh(o),s=Rh(t);return Co.exports.merge(r,s)}function Rh(o){var t,r,s,a;const u={};if(!Dr(o))return u;for(const[l,f]of Object.entries(o)){const w=ko(l)?[l]:f.chains,_=f.methods||[],T=f.events||[],R=f.rpcMap||{},N=vi(l);u[N]=dI(bs(bs({},u[N]),f),{chains:ao(w,(t=u[N])==null?void 0:t.chains),methods:ao(_,(r=u[N])==null?void 0:r.methods),events:ao(T,(s=u[N])==null?void 0:s.events),rpcMap:bs(bs({},R),(a=u[N])==null?void 0:a.rpcMap)})}return u}function yI(o){return o.includes(":")?o.split(":")[2]:o}function mI(o){const t={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],l=s.accounts||[],f=ko(r)?[r]:s.chains?s.chains:dl(s.accounts);t[r]={chains:f,methods:a,events:u,accounts:l}}return t}function go(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const fl={},ye=o=>fl[o],yo=(o,t)=>{fl[o]=t};class vI{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=fr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Yt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ut(new Zt(s,ye("disableProviderPing")))}}class wI{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Yt(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ut(new Zt(s,ye("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(fr(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class bI{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=fr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Yt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ut(new Zt(s,ye("disableProviderPing")))}}class _I{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=fr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Yt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ut(new Zt(s,ye("disableProviderPing")))}}class EI{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=fr(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ut(new Zt(s,ye("disableProviderPing")))}}class II{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=fr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Yt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ut(new Zt(s,ye("disableProviderPing")))}}class PI{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=fr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Yt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ut(new Zt(s,ye("disableProviderPing")))}}class SI{constructor(t){this.name="near",this.namespace=t.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Yt(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Yt(t,this.namespace);return typeof s>"u"?void 0:new Ut(new Zt(s,ye("disableProviderPing")))}}var OI=Object.defineProperty,RI=Object.defineProperties,AI=Object.getOwnPropertyDescriptors,Ah=Object.getOwnPropertySymbols,NI=Object.prototype.hasOwnProperty,TI=Object.prototype.propertyIsEnumerable,Nh=(o,t,r)=>t in o?OI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,_s=(o,t)=>{for(var r in t||(t={}))NI.call(t,r)&&Nh(o,r,t[r]);if(Ah)for(var r of Ah(t))TI.call(t,r)&&Nh(o,r,t[r]);return o},mo=(o,t)=>RI(o,AI(t));class Ko{constructor(t){this.events=new H.Ct,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:I.ot(I.k({level:(t==null?void 0:t.logger)||Ih})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Ko(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:_s({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){const a=new Date().getTime();this.request(t,s).then(u=>r(null,I.formatJsonRpcResult(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:Pe("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=mI(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==ll)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(hr(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await KE.init({logger:this.providerOpts.logger||Ih,relayUrl:this.providerOpts.relayUrl||sI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>vi(r)))];yo("client",this.client),yo("events",this.events),yo("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=fI(r,this.session),a=dl(s),u=gI(this.namespaces,this.optionalNamespaces),l=mo(_s({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new wI({namespace:l});break;case"solana":this.rpcProviders[r]=new bI({namespace:l});break;case"cosmos":this.rpcProviders[r]=new _I({namespace:l});break;case"polkadot":this.rpcProviders[r]=new vI({namespace:l});break;case"cip34":this.rpcProviders[r]=new EI({namespace:l});break;case"elrond":this.rpcProviders[r]=new II({namespace:l});break;case"multiversx":this.rpcProviders[r]=new PI({namespace:l});break;case"near":this.rpcProviders[r]=new SI({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&hr(a)&&this.events.emit("accountsChanged",a.map(yI))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,l=vi(a),f=go(a)!==go(u)?`${l}:${go(u)}`:a;this.onChainChanged(f)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=mo(_s({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",mo(_s({},Pe("USER_DISCONNECTED")),{data:t.topic}))}),this.on(Mt.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(l=>vi(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=vi(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Ph}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Ph}/${t}`)}}const CI=Ko,$I="wc",xI="ethereum_provider",DI=`${$I}@2:${xI}:`,FI="https://rpc.walletconnect.com/v1/",Rs=["eth_sendTransaction","personal_sign"],gl=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],As=["chainChanged","accountsChanged"],yl=["chainChanged","accountsChanged","message","disconnect","connect"];var jI=Object.defineProperty,qI=Object.defineProperties,UI=Object.getOwnPropertyDescriptors,Th=Object.getOwnPropertySymbols,MI=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable,Ch=(o,t,r)=>t in o?jI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,bi=(o,t)=>{for(var r in t||(t={}))MI.call(t,r)&&Ch(o,r,t[r]);if(Th)for(var r of Th(t))LI.call(t,r)&&Ch(o,r,t[r]);return o},$h=(o,t)=>qI(o,UI(t));function Ns(o){return Number(o[0].split(":")[1])}function vo(o){return`0x${o.toString(16)}`}function kI(o){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:l,rpcMap:f}=o;if(!wo(t))throw new Error("Invalid chains");const w={chains:t,methods:s||Rs,events:u||As,rpcMap:bi({},t.length?{[Ns(t)]:f[Ns(t)]}:{})},_=u==null?void 0:u.filter(M=>!As.includes(M)),T=s==null?void 0:s.filter(M=>!Rs.includes(M));if(!r&&!l&&!a&&!(_!=null&&_.length)&&!(T!=null&&T.length))return{required:t.length?w:void 0};const R=(_==null?void 0:_.length)&&(T==null?void 0:T.length)||!r,N={chains:[...new Set(R?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:gl))],events:[...new Set(w.events.concat(l!=null&&l.length?l:yl))],rpcMap:f};return{required:t.length?w:void 0,optional:r.length?N:void 0}}class xs{constructor(){this.events=new H.eventsExports.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=DI,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new xs;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=kI(this.rpc);try{const a=await new Promise(async(l,f)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(_=>{!_.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),f(new Error("Connection request reset. Please try again.")))})),await this.signer.connect($h(bi({namespaces:bi({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(_=>{l(_)}).catch(_=>{f(new Error(_.message))})});if(!a)return;const u=yw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:vo(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",vo(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",$h(bi({},vw("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",vo(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],l=a.concat(u);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const f=a.length?(t==null?void 0:t.methods)||Rs:[],w=a.length?(t==null?void 0:t.events)||As:[],_=(t==null?void 0:t.optionalMethods)||[],T=(t==null?void 0:t.optionalEvents)||[],R=(t==null?void 0:t.rpcMap)||this.buildRpcMap(l,t.projectId),N=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(M=>this.formatChainId(M)),optionalChains:u.map(M=>this.formatChainId(M)),methods:f,events:w,optionalMethods:_,optionalEvents:T,rpcMap:R,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:N,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Ns(this.rpc.chains):Ns(this.rpc.optionalChains),this.signer=await CI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Promise.resolve().then(()=>require("./index-Caf1ILOw.js")).then(a=>a.index);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(bi({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&wo(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&wo(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${FI}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const zI=xs;exports.EthereumProvider=zI;exports.OPTIONAL_EVENTS=yl;exports.OPTIONAL_METHODS=gl;exports.REQUIRED_EVENTS=As;exports.REQUIRED_METHODS=Rs;exports.default=xs;
